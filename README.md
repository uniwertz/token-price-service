# Token Price Service

Production-ready ÑĞµÑ€Ğ²Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ†ĞµĞ½ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ², Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‰Ğ¸Ğ¹ Ğ½Ğ° Kubernetes Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¼ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸ĞµĞ¼ Ñ‡ĞµÑ€ĞµĞ· CronJob ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚.

## Ğ§Ñ‚Ğ¾ ÑĞ´ĞµĞ»Ğ°Ğ½Ğ¾ Ğ¿Ğ¾ ĞºĞ¾Ğ´Ñƒ?

- ĞŸÑ€Ğ¸Ğ²ĞµĞ» ĞºĞ¾Ğ´ Ğº Clean Architecture
- ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ» Ğ³Ğ¾Ñ€ÑÑ‡Ğ¸Ğ¹ Ğ¿ÑƒÑ‚ÑŒ Ğ¿Ğ¾Ğ´ Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ†ĞµĞ½

## Ğ§Ñ‚Ğ¾ ÑĞ´ĞµĞ»Ğ°Ğ½Ğ¾ Ğ´Ğ»Ñ production?

- Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ğ» Ğ±Ğ°Ğ·Ñƒ Ğ’Ğ¡Ğ•ĞœĞ˜ Ñ‚Ğ¾ĞºĞµĞ½Ğ°Ğ¼Ğ¸ ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‚ (~15 Ñ‚Ñ‹Ñ. ÑˆÑ‚). ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ? Production - ÑÑ‚Ğ¾ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ Ğ½ÑƒĞ¶Ğ½Ñ‹ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² production-Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğ¸ + Ñ†ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ´Ğ»Ñ ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ğ¾Ğ³Ğ¾ ÑĞ·ĞµÑ€Ğ°.
- ĞšÑƒĞ¿Ğ¸Ğ» Ğ´Ğ¾Ğ¼ĞµĞ½ Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ (dsavin.tech)
- ĞÑ€ĞµĞ½Ğ´Ğ¾Ğ²Ğ°Ğ» ĞºĞ»Ğ°ÑÑ‚ĞµÑ€ Kubernetes (https://cloud.vk.com/)
- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ğ» CI/CD - Ğ¿Ñ€Ğ¸ Ñ€ĞµĞ»Ğ¸Ğ·Ğµ Ğ¿Ğ¾ Ñ‚ĞµĞ³Ñƒ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€ Ğ¿Ğ¾Ğ´Ñ…Ğ²Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ€ĞµĞ»Ğ¸Ğ· Ğ¸ Ñ€Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ Ñƒ ÑĞµĞ±Ñ

Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²:
https://dsavin.tech/pricing/tokens?page=1&limit=10
(Ñ†ĞµĞ½Ñ‹ Ğ¼ĞµĞ½ÑÑÑ‚ÑÑ ĞºĞ°Ğ¶Ğ´ÑƒÑ Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ)

Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞµÑ€Ğ²Ğ¸ÑĞ°:
https://dsavin.tech/pricing/status

#### Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ°

![Kubernetes Ñ€ĞµÑÑƒÑ€ÑÑ‹ (namespace token-price-service)](kube.png)

## Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚

### Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- Node.js 18+ Ğ¸ npm
- Kubernetes ĞºĞ»Ğ°ÑÑ‚ĞµÑ€ (Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 1 worker node)
- kubectl Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ Ğ¸ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½ Ğº ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ñƒ
- ArgoCD ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ² ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğµ (Ğ´Ğ»Ñ GitOps)
- Docker Ğ´Ğ»Ñ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸

### Development (Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°)
```bash
# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
npm install

# Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ (Postgres + Kafka)
docker-compose up -d postgres kafka

# ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
npx prisma migrate dev
npx prisma generate

# Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
npm run start:dev
```

### Production (Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² Kubernetes-ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğµ)

## Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº

- Node.js + TypeScript + NestJS
- PostgreSQL + Prisma
- Kafka Ğ´Ğ»Ñ messaging
- Zod Ğ´Ğ»Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸
- Docker + Kubernetes
- OpenTelemetry Ğ´Ğ»Ñ Ñ‚ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ğ¸
- Jest Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Clean Architecture Ñ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸ĞµĞ¼ Ğ½Ğ° ÑĞ»Ğ¾Ğ¸:
- Domain Layer: ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚Ğ¸, Value Objects, Ğ´Ğ¾Ğ¼ĞµĞ½Ğ½Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹
- Application Layer: use cases, ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹, Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸
- Infrastructure Layer: Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸, Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹, messaging
- Interface Layer: REST ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€Ñ‹, API endpoints

## Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°

### Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

```
src/
â”œâ”€â”€ app/                   # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
â”œâ”€â”€ contexts/              # Bounded Contexts (DDD)
â”‚   â””â”€â”€ pricing/           # Pricing Context
â”‚       â”œâ”€â”€ domain/        # Domain Layer
â”‚       â”œâ”€â”€ application/   # Application Layer
â”‚       â”œâ”€â”€ infrastructure/# Infrastructure Layer
â”‚       â””â”€â”€ interface/     # Interface Layer
â”œâ”€â”€ shared/                # Shared Kernel
â”‚   â”œâ”€â”€ domain/           # Shared Value Objects
â”‚   â”œâ”€â”€ infrastructure/   # Shared Infrastructure
â”‚   â”œâ”€â”€ kernel/           # Core Abstractions
â”‚   â””â”€â”€ utils/            # Utilities
â””â”€â”€ services/             # Legacy Services
```

### ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸

```bash
npm run build              # Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
npm run start:dev          # Development Ñ€ĞµĞ¶Ğ¸Ğ¼
npm run start:prod         # Production Ñ€ĞµĞ¶Ğ¸Ğ¼
npm run lint               # Ğ›Ğ¸Ğ½Ñ‚Ğ¸Ğ½Ğ³
npm run format             # Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ´Ğ°
npm run prisma:migrate     # ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ‘Ğ”
npm run prisma:studio      # Prisma Studio
```

### Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²

Ğ¡Ñ…ĞµĞ¼Ğ° Prisma ÑƒĞ¶Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ° Ğ´Ğ»Ñ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ². ĞŸÑ€Ğ¾ÑÑ‚Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ½Ğ¾Ğ²ÑƒÑ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ `tokens`:

```sql
INSERT INTO tokens (
  contract_address, symbol, display_name, decimal_places,
  is_native_token, chain_id, is_system_protected,
  last_modified_by, display_priority, current_price
) VALUES (
  '\x1234...', 'NEW', 'New Token', 18,
  false, 'chain-id', false,
  'admin', 100, 0
);
```

### CI/CD Pipeline

ĞŸÑ€Ğ¾ĞµĞºÑ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ **GitHub Actions** Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ CI/CD Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ°.

#### Workflow: `.github/workflows/ci-cd.yml`

**Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ñ‹:**
- `pull_request` â†’ `main` (Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² `gitops/**`)
- `push` Ñ‚ĞµĞ³Ğ¾Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ° `v*.*.*`

**Ğ­Ñ‚Ğ°Ğ¿Ñ‹ (Jobs):**

1. **test** - Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ Ğ½Ğ° PR Ğ¸ Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ Ñ‚ĞµĞ³Ğ°
   - Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ Node.js 18
   - Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ (`npm ci`)
   - Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ğ»Ğ¸Ğ½Ñ‚Ğ¸Ğ½Ğ³ (`npm run lint`)
   - Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ unit Ñ‚ĞµÑÑ‚Ñ‹ (`npm run test`)
   - Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ e2e Ñ‚ĞµÑÑ‚Ñ‹ (`npm run test:e2e`)
   - Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‰Ğ¸Ğµ Postgres Ğ¸ Kafka (Ñ‡ĞµÑ€ĞµĞ· Docker services)

2. **build** - Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ñ‚ĞµĞ³Ğ¾Ğ² Ğ¿Ğ¾ÑĞ»Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ñ… Ñ‚ĞµÑÑ‚Ğ¾Ğ²
   - Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Docker Ğ¾Ğ±Ñ€Ğ°Ğ· Ğ´Ğ»Ñ `linux/amd64`
   - ĞŸÑƒĞ±Ğ»Ğ¸ĞºÑƒĞµÑ‚ Ğ² GitHub Container Registry: `ghcr.io/uniwertz/token-price-service:v1.0.0`
   - Ğ¢Ğ°ĞºĞ¶Ğµ ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ñ‚ĞµĞ³ `:latest`
   - Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `docker buildx` Ğ´Ğ»Ñ ĞºÑ€Ğ¾ÑÑ-Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼ĞµĞ½Ğ½Ğ¾Ğ¹ ÑĞ±Ğ¾Ñ€ĞºĞ¸

3. **security-scan** - Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ build
   - Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ Docker Ğ¾Ğ±Ñ€Ğ°Ğ· Ñ‡ĞµÑ€ĞµĞ· **Trivy**
   - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ ÑƒÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑÑ…
   - Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ SARIF Ğ¾Ñ‚Ñ‡ĞµÑ‚

4. **gitops-update** - Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ security-scan
   - ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Ğ²ĞµÑ€ÑĞ¸Ñ Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ° Ğ² `gitops/overlays/production/deployment-patch.yaml`
   - **Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ Pull Request** Ñ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ "ğŸš€ Deploy v1.0.0 to production"
   - PR ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ¸ Ğ²ĞµÑ€ÑĞ¸Ñ Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ°
   - Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ action `peter-evans/create-pull-request@v6`
   - ĞŸĞ¾ÑĞ»Ğµ Ğ¼ĞµÑ€Ğ¶Ğ° PR, ArgoCD Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ñ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ¾Ğ¼

#### ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ñ€ĞµĞ»Ğ¸Ğ·Ğ°

```bash
# 1. Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ĞµÑÑŒ Ñ‡Ñ‚Ğ¾ Ğ²ÑĞµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² main
git checkout main
git pull origin main

# 2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ñ‚ĞµĞ³ Ğ²ĞµÑ€ÑĞ¸Ğ¸ (ÑĞ»ĞµĞ´ÑƒÑ Semantic Versioning)
git tag v1.0.0
git push origin v1.0.0

# 3. GitHub Actions Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸:
#    âœ“ Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ Ñ‚ĞµÑÑ‚Ñ‹
#    âœ“ Ğ¡Ğ¾Ğ±ĞµÑ€ĞµÑ‚ Docker Ğ¾Ğ±Ñ€Ğ°Ğ·
#    âœ“ ĞĞ¿ÑƒĞ±Ğ»Ğ¸ĞºÑƒĞµÑ‚ Ğ² GHCR
#    âœ“ ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ
#    âœ“ Ğ¡Ğ¾Ğ·Ğ´Ğ°ÑÑ‚ PR Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸ĞµĞ¼ production Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ°

# 4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¹ PR Ğ¸ ÑĞ¼ĞµÑ€Ğ¶ÑŒÑ‚Ğµ ĞµĞ³Ğ¾
#    https://github.com/uniwertz/token-price-service/pulls

# 5. ArgoCD Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ·Ğ°Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¸Ñ‚ Ğ½Ğ¾Ğ²ÑƒÑ Ğ²ĞµÑ€ÑĞ¸Ñ Ğ² ĞºĞ»Ğ°ÑÑ‚ĞµÑ€
#    (ĞµÑĞ»Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ syncPolicy.automated: true)

# 6. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ
kubectl -n token-price-service get pods
kubectl -n token-price-service rollout status deploy/token-price-service
```

#### ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ CI/CD

- **GitHub Actions**: `https://github.com/uniwertz/token-price-service/actions`
  - `CI/CD Pipeline` - Ñ‚ĞµÑÑ‚Ñ‹, ÑĞ±Ğ¾Ñ€ĞºĞ°, Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹
  - `Price Updater` - Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ†ĞµĞ½ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
- **Pull Requests**: `https://github.com/uniwertz/token-price-service/pulls`
- **Container Registry**: `https://github.com/uniwertz/token-price-service/pkgs/container/token-price-service`
- **ArgoCD UI**: `kubectl -n argocd port-forward svc/argocd-server 8080:443`

#### ĞÑ‚ĞºĞ°Ñ‚ Ğ²ĞµÑ€ÑĞ¸Ğ¸

Ğ•ÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹:

```bash
# Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 1: Ğ§ĞµÑ€ĞµĞ· revert PR
git revert <commit-hash>
git push origin main

# Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 2: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ‚ĞµĞ³ Ñ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¹ Ğ²ĞµÑ€ÑĞ¸ĞµĞ¹ ĞºĞ¾Ğ´Ğ°
git tag -d v1.0.1  # ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾
git push origin :refs/tags/v1.0.1  # ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ½Ğ° GitHub
git checkout v1.0.0  # Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ Ğº Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¹ Ğ²ĞµÑ€ÑĞ¸Ğ¸
git tag v1.0.2  # ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ‚ĞµĞ³
git push origin v1.0.2

# Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 3: Ğ ÑƒÑ‡Ğ½Ğ¾Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ° (Ğ½Ğµ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)
kubectl -n token-price-service set image deployment/token-price-service \
  token-price-service=ghcr.io/uniwertz/token-price-service:v1.0.0
```


### Ğ ÑƒÑ‡Ğ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ° (Ğ¿ĞµÑ€Ğ²Ğ¸Ñ‡Ğ½Ğ°Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°)

```bash
# 1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑĞµĞºÑ€ĞµÑ‚Ğ° Ğ´Ğ»Ñ GHCR (Ğ¾Ğ´Ğ½Ğ¾ĞºÑ€Ğ°Ñ‚Ğ½Ğ¾)
kubectl -n token-price-service create secret docker-registry ghcr-cred \
  --docker-server=ghcr.io \
  --docker-username=uniwertz \
  --docker-password=$GITHUB_TOKEN \
  --docker-email=your-email@example.com

# 2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑĞµĞºÑ€ĞµÑ‚Ğ° Ğ´Ğ»Ñ Postgres
kubectl -n token-price-service create secret generic postgres-secret \
  --from-literal=password=postgres

# 3. ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ ArgoCD Application
kubectl apply -f gitops/argocd/application.yaml

# 4. ArgoCD Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ğ½ĞµÑ‚ Ğ²ÑĞµ Ñ€ĞµÑÑƒÑ€ÑÑ‹ Ğ¸Ğ· gitops/overlays/production

# 5. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
kubectl -n token-price-service rollout status deploy/postgres
kubectl -n token-price-service rollout status deploy/kafka
kubectl -n token-price-service rollout status deploy/token-price-service
```


## ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

### ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ

| ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ |
|------------|----------|--------------|
| NODE_ENV | ĞĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ | development |
| PORT | ĞŸĞ¾Ñ€Ñ‚ ÑĞµÑ€Ğ²Ğ¸ÑĞ° | 3000 |
| DATABASE_URL | URL Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… | postgresql://postgres:postgres@postgres:5432/tokens |
| KAFKA_BROKERS | Kafka Ğ±Ñ€Ğ¾ĞºĞµÑ€Ñ‹ | kafka:9092 |
| KAFKA_CLIENT_ID | ID ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° Kafka | token-price-service |
| KAFKA_TOPIC | Ğ¢Ğ¾Ğ¿Ğ¸Ğº Kafka | token-price-updates |
| KAFKAJS_NO_PARTITIONER_WARNING | ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ KafkaJS | 1 |
| AUTO_SEED_ON_STARTUP | ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… | false |
| UPDATE_INTERVAL_SECONDS | Ğ˜Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ» Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ | 60 |
| MAX_RETRIES | ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº | 5 |
| TIMEOUT_MS | Ğ¢Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² | 60000 |

### GitOps ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ **GitOps** Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ Ñ **ArgoCD** Ğ¸ **Kustomize**:

- `gitops/base/` - Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ñ‹ (Deployment, Service, ConfigMap, Secret, PVC, Kafka, Zookeeper, Postgres)
- `gitops/overlays/production/` - ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ production (Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹, Ğ¾Ğ±Ñ€Ğ°Ğ·Ñ‹ Ğ¸Ğ· GHCR)
- `gitops/argocd/application.yaml` - ArgoCD Application Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ° GitOps:**
- Ğ”ĞµĞºĞ»Ğ°Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ¾Ğ¼ (automated sync + self-heal)
- Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ñ‡ĞµÑ€ĞµĞ· Git
- ĞÑ‚ĞºĞ°Ñ‚ Ñ‡ĞµÑ€ĞµĞ· revert ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ°
- Review Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ Ñ‡ĞµÑ€ĞµĞ· Pull Requests

#### Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° GitOps
```
gitops/
â”œâ”€â”€ argocd/
â”‚   â””â”€â”€ application.yaml          # ArgoCD Application manifest
â”œâ”€â”€ base/                          # Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ñ‹
â”‚   â”œâ”€â”€ kustomization.yaml        # Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
â”‚   â”œâ”€â”€ deployment.yaml           # ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
â”‚   â”œâ”€â”€ service.yaml              # Service Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
â”‚   â”œâ”€â”€ serviceaccount.yaml       # Service Account Ğ´Ğ»Ñ CronJob
â”‚   â”œâ”€â”€ configmap.yaml            # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
â”‚   â”œâ”€â”€ pvc-data.yaml             # PVC Ğ´Ğ»Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
â”‚   â”œâ”€â”€ pvc-logs.yaml             # PVC Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ²
â”‚   â”œâ”€â”€ cronjob.yaml              # CronJob Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ†ĞµĞ½ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
â”‚   â”œâ”€â”€ kafka-deployment.yaml     # Kafka Ğ² ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğµ
â”‚   â”œâ”€â”€ kafka-service.yaml        # Service Ğ´Ğ»Ñ Kafka
â”‚   â”œâ”€â”€ zookeeper-deployment.yaml # Zookeeper Ğ´Ğ»Ñ Kafka
â”‚   â”œâ”€â”€ zookeeper-service.yaml    # Service Ğ´Ğ»Ñ Zookeeper
â”‚   â”œâ”€â”€ postgres-deployment.yaml  # Postgres Ğ² ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğµ
â”‚   â”œâ”€â”€ postgres-service.yaml     # Service Ğ´Ğ»Ñ Postgres
â”‚   â”œâ”€â”€ postgres-pvc.yaml         # PVC Ğ´Ğ»Ñ Postgres
â”‚   â””â”€â”€ ingress.yaml              # Ingress (Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹)
â””â”€â”€ overlays/
    â””â”€â”€ production/               # Production overlay
        â”œâ”€â”€ kustomization.yaml    # ĞŸĞ°Ñ‚Ñ‡Ğ¸ Ğ´Ğ»Ñ production
        â”œâ”€â”€ deployment-patch.yaml # ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹, Ğ¾Ğ±Ñ€Ğ°Ğ· Ğ¸Ğ· GHCR
        â”œâ”€â”€ configmap-patch.yaml  # Production Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ
        â”œâ”€â”€ cronjob-patch.yaml    # ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ suspend Ğ´Ğ»Ñ CronJob
        â”œâ”€â”€ ingress-patch.yaml    # Ğ”Ğ¾Ğ¼ĞµĞ½Ñ‹ Ğ¸ TLS
        â””â”€â”€ pvc-patch.yaml        # StorageClass Ğ´Ğ»Ñ PVC
```

**Ğ’Ğ°Ğ¶Ğ½Ğ¾:** Ğ’ĞµÑ€ÑĞ¸Ñ Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ° Ğ² `deployment-patch.yaml` Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ñ‡ĞµÑ€ĞµĞ· CI/CD pipeline Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ Ñ€ĞµĞ»Ğ¸Ğ·Ğ°.


## Workflow Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ (Developer Guide)

### ĞĞ±Ğ·Ğ¾Ñ€ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ°

ĞŸÑ€Ğ¾ĞµĞºÑ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ **GitFlow-Ğ¿Ğ¾Ğ´Ğ¾Ğ±Ğ½Ñ‹Ğ¹ workflow** Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¼ CI/CD Ñ‡ĞµÑ€ĞµĞ· GitHub Actions Ğ¸ GitOps Ñ‡ĞµÑ€ĞµĞ· ArgoCD.

```
feature/* â”€â”€PRâ”€â”€> dev â”€â”€PRâ”€â”€> main â”€â”€tagâ”€â”€> CI/CD â”€â”€GitOps PRâ”€â”€> ArgoCD â”€â”€> Production
```

### Ğ’ĞµÑ‚ĞºĞ¸ Ğ¸ Ğ¸Ñ… Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ

| Ğ’ĞµÑ‚ĞºĞ° | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ | Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° | Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ |
|-------|-----------|--------|--------|
| `main` | Production-ready ĞºĞ¾Ğ´, Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡ĞµÑ€ĞµĞ· PR | Ğ—Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ğ° | ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ñ‡ĞµÑ€ĞµĞ· ArgoCD |
| `dev` | Integration-Ğ²ĞµÑ‚ĞºĞ° Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ | Ğ—Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ğ° | ĞĞµÑ‚ |
| `feature/*` | Feature-Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° | ĞĞµÑ‚ | ĞĞµÑ‚ |
| `gitops/deploy-*` | ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ PR Ğ´Ğ»Ñ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ | ĞĞ²Ñ‚Ğ¾-Ğ¼ĞµÑ€Ğ¶ | Ğ”Ğ° |

---

### 1. Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° (Feature)

**ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹:**
```bash
# ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ dev
git checkout dev
git pull origin dev

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ feature-Ğ²ĞµÑ‚ĞºÑƒ
git checkout -b feature/add-new-endpoint

# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾)
npm install
```

**Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°:**
```bash
# Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½ÑƒÑ Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ (PostgreSQL, Kafka)
docker-compose up -d

# Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ² dev-Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ
npm run start:dev

# ĞŸĞ¸ÑĞ°Ñ‚ÑŒ ĞºĞ¾Ğ´, Ñ‚ĞµÑÑ‚Ñ‹
# ...

# ĞŸÑ€Ğ¾Ğ³Ğ½Ğ°Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ñ‹ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾
npm test                # Unit Ñ‚ĞµÑÑ‚Ñ‹
npm run test:e2e        # E2E Ñ‚ĞµÑÑ‚Ñ‹
npm run lint            # Ğ›Ğ¸Ğ½Ñ‚ĞµÑ€

# ĞšĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ñ‹ (Conventional Commits)
git add .
git commit -m "feat(pricing): add endpoint for token metadata"
git commit -m "test(pricing): add e2e tests for metadata endpoint"
```

**Conventional Commits Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚:**
- `feat:` â€” Ğ½Ğ¾Ğ²Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ
- `fix:` â€” Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ°Ğ³Ğ°
- `test:` â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ/Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ğ¾Ğ²
- `refactor:` â€” Ñ€ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸
- `docs:` â€” Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸
- `chore:` â€” Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ (deps, config)

---

### 2. Pull Request Ğ² `dev`

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ PR:**
```bash
# Push feature-Ğ²ĞµÑ‚ĞºĞ¸
git push origin feature/add-new-endpoint

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ PR Ñ‡ĞµÑ€ĞµĞ· GitHub UI Ğ¸Ğ»Ğ¸ CLI
gh pr create --base dev --head feature/add-new-endpoint \
  --title "feat(pricing): add endpoint for token metadata" \
  --body "### Changes:
- Added GET /pricing/tokens/:id/metadata endpoint
- Added unit and e2e tests
- Updated OpenAPI spec

### Testing:
- Unit tests pass
- E2E tests pass
- Lint pass"
```

**CI Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ½Ğ° PR â†’ dev:**
- Lint (TypeScript, ESLint, Prettier)
- Unit Ñ‚ĞµÑÑ‚Ñ‹
- E2E Ñ‚ĞµÑÑ‚Ñ‹
- **ĞĞ±Ñ€Ğ°Ğ· ĞĞ• Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºÑƒĞµÑ‚ÑÑ** (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸)

**ĞŸĞ¾ÑĞ»Ğµ Ğ°Ğ¿Ñ€ÑƒĞ²Ğ°:**
```bash
# Merge Ñ‡ĞµÑ€ĞµĞ· GitHub UI (Squash and Merge Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)
# Ğ˜Ğ»Ğ¸ Ñ‡ĞµÑ€ĞµĞ· CLI:
gh pr merge <PR_NUMBER> --squash --delete-branch
```

---

### 3. Pull Request Ğ¸Ğ· `dev` Ğ² `main`

**ĞšĞ¾Ğ³Ğ´Ğ°:** ĞŸĞ¾ÑĞ»Ğµ Ğ½Ğ°ĞºĞ¾Ğ¿Ğ»ĞµĞ½Ğ¸Ñ Ñ„Ğ¸Ñ‡ Ğ² `dev`, Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğº Ñ€ĞµĞ»Ğ¸Ğ·Ñƒ.

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ PR:**
```bash
# Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ÑŒÑÑ Ñ‡Ñ‚Ğ¾ dev Ğ°ĞºÑ‚ÑƒĞ°Ğ»ĞµĞ½
git checkout dev
git pull origin dev

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ PR dev â†’ main
gh pr create --base main --head dev \
  --title "chore(release): prepare v1.0.8" \
  --body "### Release v1.0.8

**Features:**
- feat(pricing): add endpoint for token metadata
- feat(cronjob): optimize schedule to 5 minutes

**Fixes:**
- fix(kafka): update broker hostname

**Changes:**
- refactor(domain): improve TokenPrice value object

**Tests:**
- All unit and e2e tests passing"
```

**CI Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ½Ğ° PR â†’ main:**
- Lint
- Unit Ñ‚ĞµÑÑ‚Ñ‹
- E2E Ñ‚ĞµÑÑ‚Ñ‹
- **ĞĞ±Ñ€Ğ°Ğ· ĞĞ• Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºÑƒĞµÑ‚ÑÑ** (Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ Ñ‚ĞµĞ³Ñƒ)

**ĞŸĞ¾ÑĞ»Ğµ Ğ°Ğ¿Ñ€ÑƒĞ²Ğ°:**
```bash
# Merge Ñ‡ĞµÑ€ĞµĞ· GitHub UI (Create a merge commit)
gh pr merge <PR_NUMBER> --merge
```

---

### 4. Ğ ĞµĞ»Ğ¸Ğ· (Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµĞ³Ğ°)

**ĞŸĞ¾ÑĞ»Ğµ Ğ¼ĞµÑ€Ğ¶Ğ° PR Ğ² main:**
```bash
# ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ Ğ½Ğ° main
git checkout main
git pull origin main

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚ĞµĞ³ (Semantic Versioning)
git tag v1.0.8 -m "Release v1.0.8: metadata endpoint and cronjob optimization"

# Push Ñ‚ĞµĞ³Ğ° (Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ CI/CD)
git push origin v1.0.8
```

**Versioning:**
- `v1.0.0` â†’ `v1.0.1` â€” patch (bug fixes)
- `v1.0.0` â†’ `v1.1.0` â€” minor (new features, backward compatible)
- `v1.0.0` â†’ `v2.0.0` â€” major (breaking changes)

---

### 5. CI/CD Pipeline (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ğ¾ Ñ‚ĞµĞ³Ñƒ)

**GitHub Actions Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸:**
1. Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ñ‚ĞµÑÑ‚Ñ‹ (Lint + Unit + E2E) Ğ¸ security scan
2. Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ¸ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºÑƒĞµÑ‚ Docker Ğ¾Ğ±Ñ€Ğ°Ğ· Ğ² GHCR
3. Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ GitOps PR Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸ĞµĞ¼ Ğ²ĞµÑ€ÑĞ¸Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ°
4. ĞŸĞ¾ÑĞ»Ğµ Ğ¼ĞµÑ€Ğ¶Ğ° GitOps PR â†’ ArgoCD Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¸Ñ‚ Ğ² ĞºĞ»Ğ°ÑÑ‚ĞµÑ€

Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸: ÑĞ¼. Ñ€Ğ°Ğ·Ğ´ĞµĞ» **"CI/CD Pipeline"** Ğ²Ñ‹ÑˆĞµ.

---

### 6. Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ Ğ² Production (GitOps)

**ĞŸĞ¾ÑĞ»Ğµ Ğ¼ĞµÑ€Ğ¶Ğ° GitOps PR:**
1. **ArgoCD** Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² `main`
2. Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ñ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ¾Ğ¼ Kubernetes
3. Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ rolling update Ğ´ĞµĞ¿Ğ»Ğ¾Ñ
4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ readiness/liveness probes

**ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´ĞµĞ¿Ğ»Ğ¾Ñ:**
```bash
# Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ğ¾Ğ´Ğ°
kubectl -n token-price-service get pods

# Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ rolling update
kubectl -n token-price-service rollout status deploy/token-price-service

# Ğ›Ğ¾Ğ³Ğ¸ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
kubectl -n token-price-service logs deploy/token-price-service --tail=100 -f

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· API
curl https://dsavin.tech/pricing/status
```

**ArgoCD UI (ĞµÑĞ»Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½):**
```bash
# Port-forward Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº ArgoCD
kubectl port-forward -n argocd svc/argocd-server 8080:443

# ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ: https://localhost:8080
```

---

### 7. ĞÑ‚ĞºĞ°Ñ‚ Ğ²ĞµÑ€ÑĞ¸Ğ¸

Ğ•ÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ²ĞµÑ€ÑĞ¸Ñ:
- **Revert GitOps PR** - Ğ¾Ñ‚ĞºĞ°Ñ‚ Ñ‡ĞµÑ€ĞµĞ· Git
- **Ğ ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ¾Ñ‚ĞºĞ°Ñ‚ Ñ‡ĞµÑ€ĞµĞ· kubectl** - Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ğ¾Ñ‚ĞºĞ°Ñ‚
- **ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµĞ»Ğ¸Ğ· Ñ Ñ„Ğ¸ĞºÑĞ¾Ğ¼** - forward fix

Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸: ÑĞ¼. Ñ€Ğ°Ğ·Ğ´ĞµĞ» **"ĞÑ‚ĞºĞ°Ñ‚ Ğ²ĞµÑ€ÑĞ¸Ğ¸"** Ğ²Ñ‹ÑˆĞµ.

---

### 8. Hotfix (ÑÑ€Ğ¾Ñ‡Ğ½Ğ¾Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ² production)

**Ğ”Ğ»Ñ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ±Ğ°Ğ³Ğ¾Ğ²:**
```bash
# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ hotfix-Ğ²ĞµÑ‚ĞºÑƒ Ğ¾Ñ‚ main
git checkout main
git pull origin main
git checkout -b hotfix/critical-security-fix

# Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñƒ
# ... code ...
git commit -m "fix(security): patch CVE-2024-XXXXX"

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ PR hotfix â†’ main (Ğ¼Ğ¸Ğ½ÑƒÑ dev)
gh pr create --base main --head hotfix/critical-security-fix \
  --title "fix(security): patch CVE-2024-XXXXX" \
  --label "hotfix" --label "security"

# ĞŸĞ¾ÑĞ»Ğµ Ğ¼ĞµÑ€Ğ¶Ğ°:
git tag v1.0.9
git push origin v1.0.9

# Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ dev Ñ main
git checkout dev
git merge main
git push origin dev
```

---

### ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ğ ĞĞ—Ğ ĞĞ‘ĞĞ¢Ğ§Ğ˜Ğš                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ feature-Ğ²ĞµÑ‚ĞºÑƒ Ğ¾Ñ‚ dev                                â”‚
â”‚    git checkout -b feature/my-feature                           â”‚
â”‚                                                                 â”‚
â”‚ 2. Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° + Ñ‚ĞµÑÑ‚Ñ‹ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾                                 â”‚
â”‚    npm test && npm run test:e2e                                 â”‚
â”‚                                                                 â”‚
â”‚ 3. Push Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ PR â†’ dev                                    â”‚
â”‚    gh pr create --base dev                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CI: Pull Request Checks (Ğ½Ğ° feature â†’ dev)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Lint                                                          â”‚
â”‚ âœ“ Unit Tests                                                    â”‚
â”‚ âœ“ E2E Tests                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼ (Ğ¿Ğ¾ÑĞ»Ğµ Ğ°Ğ¿Ñ€ÑƒĞ²Ğ°)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Merge feature â†’ dev                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ (ĞºĞ¾Ğ³Ğ´Ğ° Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ñ€ĞµĞ»Ğ¸Ğ·)
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PR: dev â†’ main                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CI: Lint + Tests (Ğ±ĞµĞ· Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ°)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼ (Ğ¿Ğ¾ÑĞ»Ğµ Ğ°Ğ¿Ñ€ÑƒĞ²Ğ°)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Merge dev â†’ main                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ğ Ğ•Ğ›Ğ˜Ğ—                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ git tag v1.0.X                                                  â”‚
â”‚ git push origin v1.0.X  â—„â”€â”€ Ğ—ĞĞŸĞ£Ğ¡Ğš CI/CD                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CI/CD: GitHub Actions (Ğ½Ğ° Ñ‚ĞµĞ³)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Test: Lint + Unit + E2E + Security Scan                     â”‚
â”‚ 2. Build: Docker Ğ¾Ğ±Ñ€Ğ°Ğ· â†’ GHCR                                   â”‚
â”‚ 3. GitOps PR: Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ deployment-patch.yaml                    â”‚
â”‚ 4. Auto-merge GitOps PR â†’ main                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PRODUCTION: ArgoCD (GitOps)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² main                                â”‚
â”‚ 2. ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ· Ğ² ĞºĞ»Ğ°ÑÑ‚ĞµÑ€                              â”‚
â”‚ 3. Rolling update Ğ´ĞµĞ¿Ğ»Ğ¾Ñ                                        â”‚
â”‚ 4. Health checks (readiness/liveness)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                  PRODUCTION READY
```

---

### Ğ§ĞµĞº-Ğ»Ğ¸ÑÑ‚ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ°

**ĞŸĞµÑ€ĞµĞ´ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸ĞµĞ¼ PR:**
- [ ] ĞšĞ¾Ğ´ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ ÑÑ‚Ğ¸Ğ»Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° (lint pass)
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ unit-Ñ‚ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ e2e-Ñ‚ĞµÑÑ‚Ñ‹ (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾)
- [ ] Ğ’ÑĞµ Ñ‚ĞµÑÑ‚Ñ‹ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´ÑÑ‚ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾
- [ ] Conventional Commits ÑĞ¾Ğ±Ğ»ÑĞ´ĞµĞ½Ñ‹
- [ ] README/Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ° (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾)

**ĞŸĞµÑ€ĞµĞ´ Ñ€ĞµĞ»Ğ¸Ğ·Ğ¾Ğ¼:**
- [ ] Ğ’ÑĞµ PR Ğ² `dev` ÑĞ¼ĞµÑ€Ğ¶ĞµĞ½Ñ‹
- [ ] PR `dev â†’ main` ÑĞ¾Ğ·Ğ´Ğ°Ğ½ Ğ¸ Ğ°Ğ¿Ñ€ÑƒĞ²Ğ»ĞµĞ½
- [ ] Ğ’ĞµÑ€ÑĞ¸Ñ Ñ‚ĞµĞ³Ğ° ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Semantic Versioning
- [ ] Release notes Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ (Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹)

**ĞŸĞ¾ÑĞ»Ğµ Ñ€ĞµĞ»Ğ¸Ğ·Ğ°:**
- [ ] CI/CD pipeline Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ»ÑÑ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ (Ğ·ĞµĞ»Ñ‘Ğ½Ñ‹Ğ¹)
- [ ] GitOps PR Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞ¼ĞµÑ€Ğ¶ĞµĞ½
- [ ] ArgoCD ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ» Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ
- [ ] ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ² production Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ (Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ `/pricing/status`)
- [ ] CronJob Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ†ĞµĞ½ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ (Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ jobs)

---

## ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ†ĞµĞ½

### Kubernetes CronJob (Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ Ğ¸ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½)

Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ **Kubernetes CronJob** Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ†ĞµĞ½ **ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚**. Ğ’ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸ĞºĞ° Ğ² Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¸ Ğ½ĞµÑ‚ â€” Ğ·Ğ°Ğ¿ÑƒÑĞº Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¸Ğ·Ğ²Ğ½Ğµ.

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ:**
- Ğ¤Ğ°Ğ¹Ğ»: `gitops/base/cronjob.yaml`
- Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ: `*/5 * * * *` (ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚)
- Concurrency: `Forbid` (Ğ½Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ job ĞµÑĞ»Ğ¸ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¹ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ)
- Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ: 3 ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ñ… + 3 Ğ½ĞµÑƒĞ´Ğ°Ñ‡Ğ½Ñ‹Ñ… jobs
- Retry: 2 Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸ Ğ¿Ñ€Ğ¸ Ğ½ĞµÑƒĞ´Ğ°Ñ‡Ğµ
- Ğ ĞµÑÑƒÑ€ÑÑ‹: 10m CPU / 16Mi RAM (requests), 50m CPU / 64Mi RAM (limits)

**Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ CronJob:**
```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ
kubectl -n token-price-service get cronjob price-updater

# ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ jobs
kubectl -n token-price-service get jobs --sort-by=.metadata.creationTimestamp

# ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ job
kubectl -n token-price-service logs -l app=price-updater --tail=50

# ĞŸÑ€Ğ¸Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ CronJob (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾)
kubectl -n token-price-service patch cronjob price-updater -p '{"spec":{"suspend":true}}'

# Ğ’Ğ¾Ğ·Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ CronJob
kubectl -n token-price-service patch cronjob price-updater -p '{"spec":{"suspend":false}}'

# Ğ ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº (ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ job Ğ²Ğ½Ğµ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ)
kubectl -n token-price-service create job --from=cronjob/price-updater manual-update-$(date +%s)
```

### Ğ ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº Ñ‡ĞµÑ€ĞµĞ· API

Ğ•ÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ:
```bash
# Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾
curl -X POST http://localhost:3000/pricing/trigger-update

# Ğ’ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğµ (Ğ¸Ğ· Ğ´Ñ€ÑƒĞ³Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ´Ğ°; Ğ² Ğ¿Ñ€Ğ¾Ğ´Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğ¹ Ñ‚Ğ¾ĞºĞµĞ½)
kubectl -n token-price-service exec -it deploy/token-price-service -- \
  curl -X POST -H "x-internal-job-token: $INTERNAL_JOB_TOKEN" http://localhost:3000/pricing/trigger-update
```

## API Endpoints

### Health Check
```
GET /pricing/health
```
Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑ ÑĞµÑ€Ğ²Ğ¸ÑĞ° Ğ¸ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ timestamp.

### Status
```
GET /pricing/status
```
Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ°: Ğ¾Ğ±Ñ‰ĞµĞµ Ñ‡Ğ¸ÑĞ»Ğ¾ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ğ¸ `lastUpdate` (Ğ²Ñ€ĞµĞ¼Ñ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ†ĞµĞ½).

### Trigger Update
```
POST /pricing/trigger-update
```
Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ†ĞµĞ½ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ². Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼Ğ¸ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸ĞºĞ°Ğ¼Ğ¸.

## Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Unit Ñ‚ĞµÑÑ‚Ñ‹
```bash
npm test
```

### E2E Ñ‚ĞµÑÑ‚Ñ‹
```bash
npm run test:e2e
```

### ĞŸĞ¾ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ ĞºĞ¾Ğ´Ğ°
```bash
npm run test:cov
```

## ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³

### Ğ›Ğ¾Ğ³Ğ¸
Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ JSON Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¼ĞµÑ‚ĞºĞ°Ğ¼Ğ¸ Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼.

### ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸
Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ OpenTelemetry Ğ´Ğ»Ñ ÑĞ±Ğ¾Ñ€Ğ° Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº Ğ¸ Ñ‚Ñ€Ğ°ÑÑĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸.

### Health Checks
Ğ’ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ health checks Ğ´Ğ»Ñ Kubernetes liveness Ğ¸ readiness probes.


## Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

- Ğ’ÑĞµ ÑĞµĞºÑ€ĞµÑ‚Ñ‹ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ² Kubernetes Secrets
- ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· ConfigMaps
- Health checks Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°
- Graceful shutdown Ğ´Ğ»Ñ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ

## Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹

### ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹

```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ²ÑĞµÑ… Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
kubectl get all -n token-price-service

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ñ… ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²
kubectl -n token-price-service get pods,svc,pvc,deploy

# ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
kubectl -n token-price-service logs -l app=token-price-service -f

# ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ² Kafka
kubectl -n token-price-service logs -l app=kafka -f

# ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ² Postgres
kubectl -n token-price-service logs -l app=postgres -f

# Port-forward Ğ´Ğ»Ñ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°
kubectl -n token-price-service port-forward svc/token-price-service 3000:3000

# Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğº ArgoCD (ĞµÑĞ»Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½)
kubectl -n argocd port-forward svc/argocd-server 8080:443
```