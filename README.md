# Token Price Service (OLD)

ะญัะพั ะดะพะบัะผะตะฝั ัะธะบัะธััะตั ะฒััะฒะปะตะฝะฝัะต ะฐะฝัะธะฟะฐััะตัะฝั, ะฑะฐะณะธ ะธ ะฐััะธัะตะบัััะฝัะต ะฝะตะดะพััะฐัะบะธ ะฒ ะฟัะพะตะบัะต `token-price-service`, ะฐ ัะฐะบะถะต ัะพะดะตัะถะธั ะฟัะตะดะปะพะถะตะฝะธั ะฟะพ ัะปัััะตะฝะธัะผ ั ะพะฑะพัะฝะพะฒะฐะฝะธะตะผ.

### ะัะฒะฐัะตะฝะฝัะต ัะฐะนะปั
- `src/main.ts`
- `src/app.module.ts`
- `src/services/token-price-update.service.ts`
- `src/services/mock-price.service.ts`
- `src/kafka/kafka-producer.service.ts`
- `src/models/token.entity.ts`
- `src/models/token.schema.ts`
- `src/models/token-price-update-message.ts`
- `tsconfig.json`, `package.json`

---

## 1. ะััะฒะปะตะฝะธะต ะฟัะพะฑะปะตะผ

### 1.1 ะะฝัะธะฟะฐััะตัะฝั ะธ ะฟะพัะตะฝัะธะฐะปัะฝัะต ะฑะฐะณะธ
- **ะัััะบะพ ะทะฐัะธัะฐั ะบะพะฝัะธะณััะฐัะธั (DB, Kafka, ะฟะพัั)**
  - ะ `src/app.module.ts` ะฝะฐัััะพะนะบะธ TypeORM (host, port, user, password, database) ะทะฐะดะฐะฝั ะบะพะฝััะฐะฝัะฐะผะธ. ะ `src/kafka/kafka-producer.service.ts` ะฑัะพะบะตัั Kafka ะธ `clientId` ัะฐะบะถะต ัะฐัะดะบะพะดัััั. ะ `src/main.ts` ะฟะพัั 3000 ะฝะต ะบะพะฝัะธะณััะธััะตััั.
  - ะะธัะบ: ะฝะตัะพะฒะผะตััะธะผะพััั ะพะบััะถะตะฝะธะน, ะฝะตะฒะพะทะผะพะถะฝะพััั ะฑะตะทะพะฟะฐัะฝะพะณะพ ะดะตะฟะปะพั, ััะตัะบะธ ัะตะบัะตัะพะฒ.

- **ะะพะฑะพัะฝัะต ัััะตะบัั ะฒ ะบะพะฝััััะบัะพัะฐั ะธ ะฝะฐ ััะฐััะต ะผะพะดัะปั**
  - `KafkaProducerService`: ะฒัะทะพะฒ `this.connect()` ะฒ ะบะพะฝััััะบัะพัะต (ะฐัะธะฝััะพะฝะฝัะน ะฟะพะฑะพัะฝัะน ัััะตะบั ะฑะตะท ะพะถะธะดะฐะฝะธั).
  - `AppModule.onModuleInit`: ัะธะดะธะฝะณ ะะ ะธ ะทะฐะฟััะบ ัะพะฝะพะฒะพะณะพ ัะตัะฒะธัะฐ ะพะฑะฝะพะฒะปะตะฝะธั ัะตะฝ ะฟััะผะพ ะธะท ะผะพะดัะปั.
  - ะะธัะบ: ะณะพะฝะบะธ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ, ะฝะตะพัะตะฒะธะดะฝัะน ะฟะพััะดะพะบ ััะฐััะฐ, ัััะดะฝะพััะธ ัะตััะธัะพะฒะฐะฝะธั.

- **ะะตะฟะพะปะฝะพัะตะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ะธ ะทะฐะฒะตััะตะฝะธะต ะฟัะพัะตััะฐ**
  - `src/main.ts`: ะฟัะธ ะพัะธะฑะบะต ััะฐััะฐ ะฟัะพััะพ ะปะพะณะธััะตััั `error.message`, ะฟัะพัะตัั ะฝะต ะทะฐะฒะตััะฐะตััั ั ะฝะตะฝัะปะตะฒัะผ ะบะพะดะพะผ; ะฝะต ะฒะบะปััะตะฝั shutdown hooks.
  - `KafkaProducerService.sendPriceUpdateMessage`: ะฝะตั `await` ั `producer.send`, ะพัะธะฑะบะธ ะผะพะณัั ัะตัััััั, ะฟะพะดัะฒะตัะถะดะตะฝะธั ะพัะฟัะฐะฒะบะธ ะฝะตั.
  - ะะธัะบ: ัะตัะฒะธั ะฒ ยซะฟะพะปั-ัะฐะฑะพัะตะผยป ัะพััะพัะฝะธะธ, ะฟะพัะตัั ัะพะพะฑัะตะฝะธะน, ัะปะพะถะฝะพััั ะธะฝัะธะดะตะฝั-ะผะตะฝะตะดะถะผะตะฝัะฐ.

- **ะะตัะพะพัะฒะตัััะฒะธะต ัะธะฟะพะฒ ะดะปั ะดะตะฝะตะถะฝัั ะทะฝะฐัะตะฝะธะน (decimal vs number)**
  - `Token.price` ััะฐะฝะธััั ะฒ PostgreSQL ะบะฐะบ `decimal(28,0)`, ะฝะพ ะฒ ะบะพะดะต ะธัะฟะพะปัะทัะตััั ะบะฐะบ `number`. TypeORM ะฒ Postgres, ะบะฐะบ ะฟัะฐะฒะธะปะพ, ะฒะพะทะฒัะฐัะฐะตั `string` ะดะปั `decimal`, ััะพ ะฟัะธะฒะตะดัั ะบ:
    - ััะฐะฒะฝะตะฝะธะต `oldPrice !== newPrice` ะฒัะตะณะดะฐ `true` ะธะท-ะทะฐ ะฝะตัะพะพัะฒะตัััะฒะธั ัะธะฟะพะฒ (`string` vs `number`), ััะพ ะฒัะทัะฒะฐะตั ะปะธัะฝะธะต ะพัะฟัะฐะฒะบะธ ะฒ Kafka ะธ ะทะฐะฟะธัะธ ะฒ ะะ;
    - ะฟะพัะตะฝัะธะฐะปัะฝัะต ะพัะธะฑะบะธ ะพะบััะณะปะตะฝะธั.

- **ะัะฑะปะธัะพะฒะฐะฝะธะต ะธ ะดะตะฝะพัะผะฐะปะธะทะฐัะธั ะดะฐะฝะฝัั ะฒ ัััะฝะพััะธ**
  - ะ `src/models/token.entity.ts` ะพะดะฝะพะฒัะตะผะตะฝะฝะพ ะตััั `chainId` ะธ `chain_Id`, ะฐ ัะฐะบะถะต ะฑะปะพะบะธ `chain_*` ะธ `logo_*` ะฟะพะปะตะน. ะญัะพ ัะฒะฝะฐั ะดะตะฝะพัะผะฐะปะธะทะฐัะธั ะธ ะฝะตัะพะณะปะฐัะพะฒะฐะฝะฝะพััั ะฝะตะนะผะธะฝะณะฐ (`camelCase`/`snake_Case`/ัะผะตัะตะฝะธะต ัะตะณะธัััะฐ).
  - ะะธัะบ: ัะฐััะพะถะดะตะฝะธั ะดะฐะฝะฝัั, ััะปะพะถะฝะตะฝะธะต ะผะธะณัะฐัะธะน ะธ ัะฒะพะปััะธะธ ััะตะผั, ัะพัั ัะฒัะทะฝะพััะธ.

- **ะะตัะพะณะปะฐัะพะฒะฐะฝะฝะพััั ััะตะผ ะฒะฐะปะธะดะฐัะธะธ (Zod) ั ัััะฝะพัััั**
  - `token.schema.ts` ะฟะพะฒัะพััะตั ะดะตะฝะพัะผะฐะปะธะทะพะฒะฐะฝะฝัะต ะฟะพะปั ะธ ะทะฐะดะฐัั `price` ะบะฐะบ `number`, ััะพ ัะฐััะพะดะธััั ั ะะ (`decimal`).
  - `address: z.instanceof(Buffer)` ะพะณัะฐะฝะธัะธะฒะฐะตั ะธััะพัะฝะธะบะธ ะดะฐะฝะฝัั; ัะฐััะพ ะฐะดัะตั ะฟัะธัะพะดะธั ะบะฐะบ ัััะพะบะฐ/hex ะฒ DTO.

- **ะคะพะฝะพะฒัะน ัะธะบะป ัะตัะตะท `setInterval` ั async-ะบะพะปะฑัะบะพะผ**
  - `TokenPriceUpdateService`: `setInterval` ั async ััะฝะบัะธะตะน, ะณะดะต ะพัะธะฑะบะธ ะฒะฝัััะธ ะปะพะฒัััั, ะฝะพ ะพัะตัะตะดะธ ะฒัะทะพะฒะพะฒ ะผะพะณัั ะฝะฐัะปะฐะธะฒะฐัััั, ะตัะปะธ ะฒัะฟะพะปะฝะตะฝะธะต ะดะพะปััะต ะธะฝัะตัะฒะฐะปะฐ. ะััััััะฒัะตั ะพะณัะฐะฝะธัะตะฝะธะต ะบะพะฝะบััะตะฝัะธะธ/ยซััะพัะบะฐยป ะฒัะฟะพะปะฝะตะฝะธั.
  - ะะตั ะบะพะฝัะธะณััะธััะตะผะพััะธ ะธะฝัะตัะฒะฐะปะฐ ะธะท ะพะบััะถะตะฝะธั; ะฝะฐัะฐะปัะฝัะน ะทะฐะฟััะบ ะธะท `onModuleInit` ัะบัะตััะฝ ั ัะธะดะธะฝะณะพะผ.

- **ะะพะณะธ ะธ ััะธะปั**
  - ะะตััะฐะผะธ ะธัะฟะพะปัะทัะตััั `console.error` ะฒะผะตััะพ Nest `Logger`.
  - ะะตั ะณะปะพะฑะฐะปัะฝัั `ValidationPipe`, `Config`-ะฒะฐะปะธะดะฐัะธะธ ะธ health-check.

- **ะะตัััะพะณะฐั ะบะพะผะฟะธะปััะธั TypeScript**
  - `tsconfig.json`: ะพัะบะปััะตะฝั ะผะฝะพะณะธะต ัััะพะณะธะต ัะปะฐะณะธ (`strictNullChecks`, `noImplicitAny`, `forceConsistentCasingInFileNames`, ะธ ะฟั.). ะะธัะบ ะฟัะพะฟััะบะฐ ะบะปะฐััะพะฒ ะพัะธะฑะพะบ ะฝะฐ ััะฐะฟะต ะบะพะผะฟะธะปััะธะธ.

### 1.2 ะะพะฝะบัะตัะฝัะต ะฟัะธะผะตัั ะฑะฐะณะพะฒ
- **ะะพัะตัั await ะฟัะธ ะพัะฟัะฐะฒะบะต ะฒ Kafka**
  - ะ `KafkaProducerService.sendPriceUpdateMessage` ะฝะตั `await this.producer.send(...)`, ะธะท-ะทะฐ ัะตะณะพ ะบะพะด ะฟัะพะดะพะปะถะฐะตั ะฒัะฟะพะปะฝะตะฝะธะต, ะฝะต ะดะพะถะธะดะฐััั ะฟะพะดัะฒะตัะถะดะตะฝะธั ะพัะฟัะฐะฒะบะธ.

- **ะะพะฝะบะธ ัะพะตะดะธะฝะตะฝะธั ั Kafka**
  - `connect()` ะฒัะทัะฒะฐะตััั ะฒ ะบะพะฝััััะบัะพัะต ะธ ะฝะต awaited ะฟะตัะตะด ะฟะตัะฒะพะน ะพัะฟัะฐะฒะบะพะน. ะะพะทะผะพะถะฝะฐ ะฟะพะฟััะบะฐ ะพัะฟัะฐะฒะธัั ัะพะพะฑัะตะฝะธั ะดะพ ัััะฐะฝะพะฒะปะตะฝะธั ัะพะตะดะธะฝะตะฝะธั.

- **ะะตะฒะตัะฝะพะต ััะฐะฒะฝะตะฝะธะต ัะตะฝ (ัะธะฟะพะฒะฐั ะฝะตัะพะฒะผะตััะธะผะพััั)**
  - `oldPrice !== newPrice` ะฟัะธ `oldPrice` ะบะฐะบ `string` ะธ `newPrice` ะบะฐะบ `number` ะฟัะธะฒะตะดัั ะบ ะปะพะถะฝัะผ ะพะฑะฝะพะฒะปะตะฝะธัะผ.

- **ะัััะบะพ ะทะฐัะธััะต ััััะฝัะต ะดะฐะฝะฝัะต ะะ**
  - ะะธัะบ ััะตัะตะบ ะธ ะฝะตัะพะฒะผะตััะธะผะพััะธ ั ะดะตะฟะปะพะน-ะฟัะพัะตััะฐะผะธ.

---

## 2. ะัะตะดะปะพะถะตะฝะฝัะต ะธะทะผะตะฝะตะฝะธั ะธ ะพะฑะพัะฝะพะฒะฐะฝะธะต

### 2.1 ะฃะฟัะฐะฒะปะตะฝะธะต ะบะพะฝัะธะณััะฐัะธะตะน
- **ะงัะพ ัะดะตะปะฐะฝะพ**: ะฟะฐัะฐะผะตััั ะะ, Kafka, ะธะฝัะตัะฒะฐะป ะพะฑะฝะพะฒะปะตะฝะธั ะธ ะฟะพัั ัะตัะฒะตัะฐ ะฒัะฝะตัะตะฝั ะฒ `@nestjs/config`; ะดะพะฑะฐะฒะปะตะฝะฐ ััะตะผะฐ ะฒะฐะปะธะดะฐัะธะธ ะบะพะฝัะธะณััะฐัะธะธ (`zod`).
- **ะะฐัะตะผ**: ะตะดะธะฝะพะพะฑัะฐะทะฝะพะต ัะฟัะฐะฒะปะตะฝะธะต ะพะบััะถะตะฝะธัะผะธ, ะฑะตะทะพะฟะฐัะฝะพััั ัะตะบัะตัะพะฒ, ะฟัะตะดะพัะฒัะฐัะตะฝะธะต ะบะพะฝัะธะณััะฐัะธะพะฝะฝัั ะพัะธะฑะพะบ ะฟัะธ ััะฐััะต.

### 2.2 ะะธะทะฝะตะฝะฝัะน ัะธะบะป ะฟัะธะปะพะถะตะฝะธั
- **ะงัะพ ัะดะตะปะฐะฝะพ**:
  - ะัะธะฝััะพะฝะฝะพะต ะฟะพะดะบะปััะตะฝะธะต Kafka ะฟะตัะตะฝะตัะตะฝะพ ะธะท ะบะพะฝััััะบัะพัะฐ ะฒ `onModuleInit` ั ัะฒะฝัะผ `await`.
  - ะ `main.ts` ะฒะบะปััะตะฝั `app.enableShutdownHooks()` ะธ ะบะพััะตะบัะฝะพะต ะทะฐะฒะตััะตะฝะธะต ะฟัะธ ะพัะธะฑะบะฐั (`process.exit(1)`); ะดะพะฑะฐะฒะปะตะฝั ะณะปะพะฑะฐะปัะฝัะต `ValidationPipe`.
  - ะกะธะดะธะฝะณ ะดะฐะฝะฝัั ะพัะดะตะปัะฝ ะพั ะทะฐะฟััะบะฐ ัะพะฝะพะฒะพะณะพ ะฟัะพัะตััะฐ: ัะธะดะธะฝะณ ะทะฐะฟััะบะฐะตััั ะพัะดะตะปัะฝะพะน ะบะพะผะฐะฝะดะพะน ะปะธะฑะพ ัะฟัะฐะฒะปัะตััั ัะตัะตะท ัะปะฐะณ ะพะบััะถะตะฝะธั.
- **ะะฐัะตะผ**: ะฟัะตะดัะบะฐะทัะตะผะฐั ะธะฝะธัะธะฐะปะธะทะฐัะธั, ะบะพััะตะบัะฝะพะต ะทะฐะฒะตััะตะฝะธะต, ัะฟัะฐะฒะปัะตะผะพััั ะฟัะพะด-ัะธะบะปะพะฒ.

### 2.3 Kafka-ะฟัะพะธะทะฒะพะดะธัะตะปั
- **ะงัะพ ัะดะตะปะฐะฝะพ**:
  - ะะพะฑะฐะฒะปะตะฝะพ `await producer.send(...)` ะธ ะพะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ั ัะตััะฐัะผะธ/backoff.
  - `topic`, `clientId`, `brokers` ะฟะฐัะฐะผะตััะธะทะพะฒะฐะฝั ัะตัะตะท ะบะพะฝัะธะณ.
  - ะะพะฑะฐะฒะปะตะฝั ะฟะพะดัะฒะตัะถะดะตะฝะธั ะดะพััะฐะฒะบะธ/ะผะตััะธะบะธ; ัะฐััะผะพััะตะฝั ะผะตัะฐะฝะธะทะผั DLQ/ะฟะพะฒัะพัะฝัั ะฟะพะฟััะพะบ ะฝะฐ ััะพะฒะฝะต ะฟะพััะตะฑะธัะตะปะตะน.
- **ะะฐัะตะผ**: ะธะทะฑะตะถะฐัั ะฟะพัะตัะธ ัะพะพะฑัะตะฝะธะน ะธ ะณะพะฝะพะบ ัะพะตะดะธะฝะตะฝะธั, ะฟะพะฒััะธัั ะฝะฐะฑะปัะดะฐะตะผะพััั.

### 2.4 ะะพะดะตะปั ะดะฐะฝะฝัั `Token`
- **ะงัะพ ัะดะตะปะฐะฝะพ**:
  - ะฃัััะฐะฝะตะฝะพ ะดัะฑะปะธัะพะฒะฐะฝะธะต `chainId`/`chain_Id`; ัะฝะธัะธัะธัะพะฒะฐะฝ ะฝะตะนะผะธะฝะณ (camelCase ะฒ ะบะพะดะต, snake_case ะฒ ะะ ัะตัะตะท `name`); `chain_*` ะธ `logo_*` ะฒัะฝะตัะตะฝั ะฒ ัะฒัะทะฐะฝะฝัะต ัะฐะฑะปะธัั (ะฝะพัะผะฐะปะธะทะฐัะธั) ะปะธะฑะพ ะดะตะฝะพัะผะฐะปะธะทะฐัะธั ัะพัะผะฐะปะธะทะพะฒะฐะฝะฐ ะธะฝะฒะฐัะธะฐะฝัะฐะผะธ.
  - ะะปั `price` ะฒะฝะตะดััะฝ fixedโpoint ัะพัะผะฐั: `TokenPrice` ััะฐะฝะธั ะทะฝะฐัะตะฝะธะต ะบะฐะบ `BigInt amount` ะฟัะธ ัะธะบัะธัะพะฒะฐะฝะฝะพะผ ะผะฐัััะฐะฑะต `scale=8`; ะฒ ะะ ะธัะฟะพะปัะทัะตััั `DECIMAL`, ะฒะพ ะฒะฝะตัะฝะตะผ API โ ัััะพะบะธ. ะัะธัะผะตัะธะบะฐ ะธ ััะฐะฒะฝะตะฝะธั ะฒัะฟะพะปะฝััััั ะฑะตะท float.
- **ะะฐัะตะผ**: ัะตะปะพััะฝะพััั ะดะฐะฝะฝัั, ะบะพััะตะบัะฝะพััั ะดะตะฝะตะถะฝัั ัะฐััััะพะฒ, ะพััััััะฒะธะต ะพัะธะฑะพะบ ะพะบััะณะปะตะฝะธั, ัะพะฒะผะตััะธะผะพััั ั ะพะฝัะตะนะฝโะฟะพะดัะพะดะพะผ (fixedโpoint).

### 2.5 ะกัะตะผั ะฒะฐะปะธะดะฐัะธะธ (Zod)
- **ะงัะพ ัะดะตะปะฐะฝะพ**:
  - `token.schema.ts` ะฟัะธะฒะตะดัะฝ ะฒ ัะพะพัะฒะตัััะฒะธะต ั ัััะฝะพัััั ะฟะพัะปะต ะฝะพัะผะฐะปะธะทะฐัะธะธ.
  - ะะฐะทัะตััะฝ ะฒะฒะพะด ะฐะดัะตัะฐ ะฒ ัะตะปะพะฒะตะบะพ-ะพัะธะตะฝัะธัะพะฒะฐะฝะฝะพะผ ัะพัะผะฐัะต (ัััะพะบะฐ/hex) ั ะฟัะตะพะฑัะฐะทะพะฒะฐะฝะธะตะผ ะฒ `Buffer` ะฒ ัะปะพะต ะผะฐะฟะฟะธะฝะณะฐ.
  - ะะปั ะดะตะฝะตะถะฝัั ะฟะพะปะตะน ัะตะฐะปะธะทะพะฒะฐะฝะฐ ะฒะฐะปะธะดะฐัะธั ัััะพะบะพะฒะพะณะพ ะฟัะตะดััะฐะฒะปะตะฝะธั ะปะธะฑะพ ะฟัะธะผะตะฝะตะฝั branded types.
- **ะะฐัะตะผ**: ะตะดะธะฝะฐั ะบะพะฝััะฐะบัะฝะฐั ะผะพะดะตะปั, ะฝะฐะดัะถะฝะฐั ะฒะฐะปะธะดะฐัะธั ะฒัะพะดะฝัั ะดะฐะฝะฝัั.

### 2.6 ะะฑะฝะพะฒะปะตะฝะธะต ัะตะฝ
- **ะงัะพ ัะดะตะปะฐะฝะพ**:
  - ะัะบะฐะทะฐะปะธัั ะพั `@nestjs/schedule`; ะพะฑะฝะพะฒะปะตะฝะธะต ัะตะฝ ะฒัะฟะพะปะฝัะตััั ะฒะฝะตัะฝะธะผ ะฟะปะฐะฝะธัะพะฒัะธะบะพะผ (Kubernetes CronJob). ะ ะฟัะธะปะพะถะตะฝะธะธ ะพััะฐะฒะปะตะฝ idempotent useโcase ะธ ััะธะณะณะตัโัะฝะดะฟะพะธะฝั.
  - ะะฑัะฐะฑะพัะบะฐ ะฒัะฟะพะปะฝะตะฝะฐ ะฑะฐััะฐะผะธ, ััะบะพะฝะพะผะปะตะฝั roundโtrips ะบ ะะ (batch save), ะพะณัะฐะฝะธัะตะฝะฐ ะฟะฐัะฐะปะปะตะปัะฝะพััั.
- **ะะฐัะตะผ**: ะฝะฐะดัะถะฝัะน ะธ ัะฟัะฐะฒะปัะตะผัะน ะฟัะพะดโะฟัะพัะตัั (CRON ะฝะฐ ััะพะฒะฝะต ะบะปะฐััะตัะฐ), ะฟัะตะดัะบะฐะทัะตะผะฐั ะฝะฐะณััะทะบะฐ, ะฟัะพััะพัะฐ ัะบัะฟะปัะฐัะฐัะธะธ.

### 2.7 main.ts ะธ ะบัะพัั-ััะตะทะพะฒัะต ะฐัะฟะตะบัั
- **ะงัะพ ัะดะตะปะฐะฝะพ**: ะดะพะฑะฐะฒะปะตะฝั ะณะปะพะฑะฐะปัะฝัะต ะฟะฐะนะฟั/ัะธะปัััั, health-check (ะฝะฐะฟัะธะผะตั, ัะฝะดะฟะพะนะฝั `/health`), ััััะบัััะธัะพะฒะฐะฝะฝัะต ะปะพะณะธ.
- **ะะฐัะตะผ**: ะพะฟะตัะฐะฑะตะปัะฝะพััั, ะฝะฐะฑะปัะดะฐะตะผะพััั, ะทะฐัะธัะฐ ะพั ะฝะตะฒะฐะปะธะดะฝัั ะฒัะพะดะฝัั ะดะฐะฝะฝัั.

### 2.8 TypeScript ัััะพะณะธะน ัะตะถะธะผ
- **ะงัะพ ัะดะตะปะฐะฝะพ**: ะฒะบะปััะตะฝั `strict` ะธ ัะฒัะทะฐะฝะฝัะต ัะปะฐะณะธ (`noImplicitAny`, `strictNullChecks`, `forceConsistentCasingInFileNames` ะธ ะดั.).
- **ะะฐัะตะผ**: ะปะพะฒะธัั ะบะปะฐััั ะพัะธะฑะพะบ ะฝะฐ ััะฐะฟะต ัะฑะพัะบะธ, ะฟะพะฒััะธัั ะบะฐัะตััะฒะพ ะบะพะดะฐ.

---

## 3. ะัะฐัะบะฐั ะบะฐััะฐ: ะัะพะฑะปะตะผะฐ โ ะะทะผะตะฝะตะฝะธะต โ ะะฑะพัะฝะพะฒะฐะฝะธะต

- **ะฅะฐัะดะบะพะด ะบะพะฝัะธะณััะฐัะธะธ** โ ะัะฝะตััะธ ะฒ `@nestjs/config` + ััะตะผะฐ ะฒะฐะปะธะดะฐัะธะธ โ ะะฐะดัะถะฝะพััั ะพะบััะถะตะฝะธะน, ะฑะตะทะพะฟะฐัะฝะพััั.
- **ะะพะฑะพัะฝัะต ัััะตะบัั ะฒ ะบะพะฝััััะบัะพัะฐั** โ ะะตัะตะฝะพั ะฒ `onModuleInit`/lifecycle ะธ `await` โ ะัะตะดัะบะฐะทัะตะผะฐั ะธะฝะธัะธะฐะปะธะทะฐัะธั.
- **Kafka ะฑะตะท await ะธ ัะตััะฐะตะฒ** โ `await send` + ะพะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ/ัะตััะฐะธ โ ะะฐัะฐะฝัะธัะพะฒะฐะฝะฝะฐั ะพัะฟัะฐะฒะบะฐ/ะฒะธะดะธะผะพััั ัะฑะพะตะฒ.
- **`decimal` ะบะฐะบ `number`** โ ะกััะพะบะฐ/BigNumber/ััะฐะฝััะพัะผะตั โ ะะพััะตะบัะฝัะต ััะฐะฒะฝะตะฝะธั ะธ ะพััััััะฒะธะต ะปะธัะฝะธั ะฐะฟะดะตะนัะพะฒ.
- **ะะตะฝะพัะผะฐะปะธะทะฐัะธั ะธ ะฝะตัะพะณะปะฐัะพะฒะฐะฝะฝัะต ะธะผะตะฝะฐ** โ ะะพัะผะฐะปะธะทะฐัะธั + ะตะดะธะฝัะน ััะธะปั ะธะผัะฝ โ ะฆะตะปะพััะฝะพััั ะธ ัะพะฟัะพะฒะพะถะดะฐะตะผะพััั.
- **Async ะฒ `setInterval` ะฑะตะท ััะพัะบะธ** โ `@nestjs/schedule` + ะทะฐัะธัะฐ ะพั ะบะพะฝะบััะตะฝัะฝะพะณะพ ะทะฐะฟััะบะฐ โ ะกัะฐะฑะธะปัะฝะพััั ัะพะฝะพะฒัั ะทะฐะดะฐั.
- **ะััััััะฒะธะต ะณะปะพะฑะฐะปัะฝะพะน ะฒะฐะปะธะดะฐัะธะธ/health** โ `ValidationPipe`, health-check โ ะะฟะตัะฐะฑะตะปัะฝะพััั, ะฑะตะทะพะฟะฐัะฝะพััั.
- **ะะตัััะพะณะธะน TS** โ ะะบะปััะธัั strict-ัะปะฐะณะธ โ ะะฐะฝะฝะตะต ะพะฑะฝะฐััะถะตะฝะธะต ะพัะธะฑะพะบ.

---

## 4. ะัะธะพัะธัะตัั ะฒะฝะตะดัะตะฝะธั
1) ะะตะทะพะฟะฐัะฝะพััั ะธ ะฝะฐะดัะถะฝะพััั: ะบะพะฝัะธะณััะฐัะธั, ะบะพััะตะบัะฝะฐั ะธะฝะธัะธะฐะปะธะทะฐัะธั Kafka, ัััะพะณะธะน TS.
2) ะะพััะตะบัะฝะพััั ะดะพะผะตะฝะฐ: ะฟัะธะฒะตะดะตะฝะธะต `price` ะบ ะฑะตะทะพะฟะฐัะฝะพะผั ัะธะฟั, ััััะฐะฝะตะฝะธะต ะดัะฑะปะธัะพะฒะฐะฝะธั ะฟะพะปะตะน.
3) ะะฟะตัะฐัะธะพะฝะฝัะต ะฐัะฟะตะบัั: health-check, ะฒะฐะปะธะดะฐัะธั ะบะพะฝัะธะณััะฐัะธะธ, structured logging.
4) ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั ะธ ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะต: ัะตะดัะปะตั, ะฑะฐััะธ/ะฟะฐัะฐะปะปะตะปะธะทะผ ั ะปะธะผะธัะฐะผะธ.

---

## 5. ะะพัะตะฝัะธะฐะปัะฝัะต ัะธัะบะธ ะธ ะผะธะณัะฐัะธะธ
- ะะพัะผะฐะปะธะทะฐัะธั ัััะฝะพััะธ ะฟะพััะตะฑัะตั ะผะธะณัะฐัะธะน ะะ ะธ ะฒะพะทะผะพะถะฝะพะน ะฐะดะฐะฟัะฐัะธะธ ะฟะพััะตะฑะธัะตะปะตะน Kafka.
- ะะทะผะตะฝะตะฝะธะต ะฟัะตะดััะฐะฒะปะตะฝะธั `price` ะฟะพััะตะฑัะตั ะฐะดะฐะฟัะฐัะธะธ ะผะตัั, ะณะดะต ะพะถะธะดะฐะตััั `number`.
- ะัะฝะตัะตะฝะธะต ัะธะดะตัะฐ ะธะท `onModuleInit` ะธะทะผะตะฝะธั ััะฐััะพะฒัะน ััะตะฝะฐัะธะน โ ะฟะพััะตะฑัะตััั ะพะฑะฝะพะฒะปะตะฝะธะต README/ัะบัะธะฟัะพะฒ.


# Token Price Service (NEW)

ะกะดะตะปะฐะป production-ready ัะตัะฒะธั, ะบะพัะพััะน ะพะฑะฝะพะฒะปัะตั ัะตะฝั ะฝะฐ ัะพะบะตะฝั ะฟะพ ะฒะฝะตัะฝะตะผั ัะฐัะฟะธัะฐะฝะธั (ะบะฐะถะดัะต 5 ะผะธะฝัั ัะตัะตะท Kubernetes CronJob).

## ะงัะพ ัะดะตะปะฐะฝะพ ะฟะพ ะบะพะดั?

- ะัะธะฒะตะป ะบะพะด ะบ Clean Architecture
- ะะฟัะธะผะธะทะธัะพะฒะฐะป ะณะพัััะธะน ะฟััั ะฟะพะด ะฟะฐะณะธะฝะฐัะธั ะธ ะพะฑะฝะพะฒะปะตะฝะธั ัะตะฝ

## ะงัะพ ัะดะตะปะฐะฝะพ ะดะปั production?

- ะะฐะฟะพะปะฝะธะป ะฑะฐะทั ะะกะะะ ัะพะบะตะฝะฐะผะธ ะบะพัะพััะต ัััะตััะฒััั (~15 ััั. ัั). ะะพัะตะผั? Production - ััะพ ะทะฝะฐัะธั ะฝัะถะฝั ัะตะฐะปัะฝัะต ะดะฐะฝะฝัะต ะฒ production-ะพะบััะถะตะฝะธะธ + ัะตะฝะฝะพััั ะดะปั ะบะพะฝะตัะฝะพะณะพ ัะทะตัะฐ.
- ะัะฟะธะป ะดะพะผะตะฝ ะดะปั ัะตััะพะฒะพะณะพ ะทะฐะดะฐะฝะธั (dsavin.tech)
- ะัะตะฝะดะพะฒะฐะป ะบะปะฐััะตั Kubernetes (https://cloud.vk.com/)
- ะะฐัััะพะธะป CI/CD - ะฟัะธ ัะตะปะธะทะต ะฟะพ ัะตะณั ะบะปะฐััะตั ะฟะพะดัะฒะฐััะฒะฐะตั ัะตะปะธะท ะธ ัะฐะทะฒะพัะฐัะธะฒะฐะตั ั ัะตะฑั

ะกะฟะธัะพะบ ัะพะบะตะฝะพะฒ:
https://dsavin.tech/pricing/tokens?page=1&limit=10
(ัะตะฝั ะผะตะฝััััั ะบะฐะถะดัั ะผะธะฝััั)

ะกัะฐััั ัะตัะฒะธัะฐ:
https://dsavin.tech/pricing/status

#### ะกะพััะพัะฝะธะต ะบะปะฐััะตัะฐ

![Kubernetes ัะตััััั (namespace token-price-service)](kube.png)

## ะัััััะน ััะฐัั

### ะขัะตะฑะพะฒะฐะฝะธั
- Node.js 18+ ะธ npm
- Kubernetes ะบะปะฐััะตั (ะผะธะฝะธะผัะผ 1 worker node)
- kubectl ะฝะฐัััะพะตะฝ ะธ ะฟะพะดะบะปััะตะฝ ะบ ะบะปะฐััะตัั
- ArgoCD ัััะฐะฝะพะฒะปะตะฝ ะฒ ะบะปะฐััะตัะต (ะดะปั GitOps)
- Docker ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ

### Development (ะปะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ)
```bash
# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
npm install

# ะะฐะฟััะบ ะทะฐะฒะธัะธะผะพััะตะน (Postgres + Kafka)
docker-compose up -d postgres kafka

# ะะธะณัะฐัะธะธ ะฑะฐะทั ะดะฐะฝะฝัั
npx prisma migrate dev
npx prisma generate

# ะะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั
npm run start:dev
```

### Production (ัะฐะทะฒะตัััะฒะฐะฝะธะต ะฒ Kubernetes-ะบะปะฐััะตัะต)

## ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

- Node.js + TypeScript + NestJS
- PostgreSQL + Prisma
- Kafka ะดะปั messaging
- Zod ะดะปั ะฒะฐะปะธะดะฐัะธะธ
- Docker + Kubernetes
- OpenTelemetry ะดะปั ัะตะปะตะผะตััะธะธ
- Jest ะดะปั ัะตััะธัะพะฒะฐะฝะธั

## ะััะธัะตะบัััะฐ

ะัะธะปะพะถะตะฝะธะต ะธัะฟะพะปัะทัะตั Clean Architecture ั ัะฐะทะดะตะปะตะฝะธะตะผ ะฝะฐ ัะปะพะธ:
- Domain Layer: ัััะฝะพััะธ, Value Objects, ะดะพะผะตะฝะฝัะต ัะตัะฒะธัั
- Application Layer: use cases, ะบะพะผะฐะฝะดั, ะพะฑัะฐะฑะพััะธะบะธ
- Infrastructure Layer: ัะตะฟะพะทะธัะพัะธะธ, ะฒะฝะตัะฝะธะต ัะตัะฒะธัั, messaging
- Interface Layer: REST ะบะพะฝััะพะปะปะตัั, API endpoints

## ะะฐะทัะฐะฑะพัะบะฐ

### ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
src/
โโโ app/                   # ะะพะฝัะธะณััะฐัะธั ะฟัะธะปะพะถะตะฝะธั
โโโ contexts/              # Bounded Contexts (DDD)
โ   โโโ pricing/           # Pricing Context
โ       โโโ domain/        # Domain Layer
โ       โโโ application/   # Application Layer
โ       โโโ infrastructure/# Infrastructure Layer
โ       โโโ interface/     # Interface Layer
โโโ shared/                # Shared Kernel
โ   โโโ domain/           # Shared Value Objects
โ   โโโ infrastructure/   # Shared Infrastructure
โ   โโโ kernel/           # Core Abstractions
โ   โโโ utils/            # Utilities
โโโ services/             # Legacy Services
```

### ะะพะผะฐะฝะดั ัะฐะทัะฐะฑะพัะบะธ

```bash
npm run build              # ะกะฑะพัะบะฐ ะฟัะพะตะบัะฐ
npm run start:dev          # Development ัะตะถะธะผ
npm run start:prod         # Production ัะตะถะธะผ
npm run lint               # ะะธะฝัะธะฝะณ
npm run format             # ะคะพัะผะฐัะธัะพะฒะฐะฝะธะต ะบะพะดะฐ
npm run prisma:migrate     # ะะธะณัะฐัะธะธ ะะ
npm run prisma:studio      # Prisma Studio
```

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั ัะพะบะตะฝะพะฒ

ะกัะตะผะฐ Prisma ัะถะต ะณะพัะพะฒะฐ ะดะปั ะดะพะฑะฐะฒะปะตะฝะธั ะฝะพะฒัั ัะพะบะตะฝะพะฒ. ะัะพััะพ ะดะพะฑะฐะฒััะต ะฝะพะฒัั ะทะฐะฟะธัั ะฒ ัะฐะฑะปะธัั `tokens`:

```sql
INSERT INTO tokens (
  contract_address, symbol, display_name, decimal_places,
  is_native_token, chain_id, is_system_protected,
  last_modified_by, display_priority, current_price
) VALUES (
  '\x1234...', 'NEW', 'New Token', 18,
  false, 'chain-id', false,
  'admin', 100, 0
);
```

### CI/CD Pipeline

ะัะพะตะบั ะธัะฟะพะปัะทัะตั **GitHub Actions** ะดะปั ะฟะพะปะฝะพัััั ะฐะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝะพะณะพ CI/CD ะฟัะพัะตััะฐ.

#### Workflow: `.github/workflows/ci-cd.yml`

**ะขัะธะณะณะตัั:**
- `pull_request` โ `main` (ะธะณะฝะพัะธััะตั ะธะทะผะตะฝะตะฝะธั ะฒ `gitops/**`)
- `push` ัะตะณะพะฒ ัะพัะผะฐัะฐ `v*.*.*`

**ะญัะฐะฟั (Jobs):**

1. **test** - ะะฐะฟััะบะฐะตััั ะฝะฐ PR ะธ ะฟัะธ ัะพะทะดะฐะฝะธะธ ัะตะณะฐ
   - ะฃััะฐะฝะฐะฒะปะธะฒะฐะตั Node.js 18
   - ะฃััะฐะฝะฐะฒะปะธะฒะฐะตั ะทะฐะฒะธัะธะผะพััะธ (`npm ci`)
   - ะะฐะฟััะบะฐะตั ะปะธะฝัะธะฝะณ (`npm run lint`)
   - ะะฐะฟััะบะฐะตั unit ัะตััั (`npm run test`)
   - ะะฐะฟััะบะฐะตั e2e ัะตััั (`npm run test:e2e`)
   - ะขัะตะฑัะตั ัะฐะฑะพัะฐััะธะต Postgres ะธ Kafka (ัะตัะตะท Docker services)

2. **build** - ะะฐะฟััะบะฐะตััั ัะพะปัะบะพ ะดะปั ัะตะณะพะฒ ะฟะพัะปะต ััะฟะตัะฝัั ัะตััะพะฒ
   - ะกะพะฑะธัะฐะตั Docker ะพะฑัะฐะท ะดะปั `linux/amd64`
   - ะัะฑะปะธะบัะตั ะฒ GitHub Container Registry: `ghcr.io/uniwertz/token-price-service:v1.0.0`
   - ะขะฐะบะถะต ัะพะทะดะฐะตั ัะตะณ `:latest`
   - ะัะฟะพะปัะทัะตั `docker buildx` ะดะปั ะบัะพัั-ะฟะปะฐััะพัะผะตะฝะฝะพะน ัะฑะพัะบะธ

3. **security-scan** - ะะฐะฟััะบะฐะตััั ะฟะพัะปะต build
   - ะกะบะฐะฝะธััะตั Docker ะพะฑัะฐะท ัะตัะตะท **Trivy**
   - ะัะพะฒะตััะตั ััะทะฒะธะผะพััะธ ะฒ ะทะฐะฒะธัะธะผะพัััั
   - ะะตะฝะตัะธััะตั SARIF ะพััะตั

4. **gitops-update** - ะะฐะฟััะบะฐะตััั ะฟะพัะปะต security-scan
   - ะะฑะฝะพะฒะปัะตั ะฒะตััะธั ะพะฑัะฐะทะฐ ะฒ `gitops/overlays/production/deployment-patch.yaml`
   - **ะกะพะทะดะฐะตั Pull Request** ั ะฝะฐะทะฒะฐะฝะธะตะผ "๐ Deploy v1.0.0 to production"
   - PR ัะพะดะตัะถะธั ะพะฟะธัะฐะฝะธะต ะธะทะผะตะฝะตะฝะธะน ะธ ะฒะตััะธั ะพะฑัะฐะทะฐ
   - ะัะฟะพะปัะทัะตั action `peter-evans/create-pull-request@v6`
   - ะะพัะปะต ะผะตัะถะฐ PR, ArgoCD ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะธะฝััะพะฝะธะทะธััะตั ะธะทะผะตะฝะตะฝะธั ั ะบะปะฐััะตัะพะผ

#### ะัะพัะตัั ัะตะปะธะทะฐ

```bash
# 1. ะฃะฑะตะดะธัะตัั ััะพ ะฒัะต ะธะทะผะตะฝะตะฝะธั ะฒ main
git checkout main
git pull origin main

# 2. ะกะพะทะดะฐะนัะต ัะตะณ ะฒะตััะธะธ (ัะปะตะดัั Semantic Versioning)
git tag v1.0.0
git push origin v1.0.0

# 3. GitHub Actions ะฐะฒัะพะผะฐัะธัะตัะบะธ:
#    โ ะะฐะฟัััะธั ัะตััั
#    โ ะกะพะฑะตัะตั Docker ะพะฑัะฐะท
#    โ ะะฟัะฑะปะธะบัะตั ะฒ GHCR
#    โ ะัะพะฒะตัะธั ะฑะตะทะพะฟะฐัะฝะพััั
#    โ ะกะพะทะดะฐัั PR ั ะพะฑะฝะพะฒะปะตะฝะธะตะผ production ะผะฐะฝะธัะตััะฐ

# 4. ะัะพะฒะตัััะต ัะพะทะดะฐะฝะฝัะน PR ะธ ัะผะตัะถััะต ะตะณะพ
#    https://github.com/uniwertz/token-price-service/pulls

# 5. ArgoCD ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะดะตะฟะปะพะธั ะฝะพะฒัั ะฒะตััะธั ะฒ ะบะปะฐััะตั
#    (ะตัะปะธ ะฝะฐัััะพะตะฝ syncPolicy.automated: true)

# 6. ะัะพะฒะตัััะต ััะฐััั ะดะตะฟะปะพั
kubectl -n token-price-service get pods
kubectl -n token-price-service rollout status deploy/token-price-service
```

#### ะะพะฝะธัะพัะธะฝะณ CI/CD

- **GitHub Actions**: `https://github.com/uniwertz/token-price-service/actions`
  - `CI/CD Pipeline` - ัะตััั, ัะฑะพัะบะฐ, ะดะตะฟะปะพะน
  - `Price Updater` - ะฐะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ัะตะฝ ะบะฐะถะดัะต 5 ะผะธะฝัั
- **Pull Requests**: `https://github.com/uniwertz/token-price-service/pulls`
- **Container Registry**: `https://github.com/uniwertz/token-price-service/pkgs/container/token-price-service`
- **ArgoCD UI**: `kubectl -n argocd port-forward svc/argocd-server 8080:443`

#### ะัะบะฐั ะฒะตััะธะธ

ะัะปะธ ะฝัะถะฝะพ ะพัะบะฐัะธัั ะดะตะฟะปะพะน:

```bash
# ะะฐัะธะฐะฝั 1: ะงะตัะตะท revert PR
git revert <commit-hash>
git push origin main

# ะะฐัะธะฐะฝั 2: ะกะพะทะดะฐัั ะฝะพะฒัะน ัะตะณ ั ะฟัะตะดัะดััะตะน ะฒะตััะธะตะน ะบะพะดะฐ
git tag -d v1.0.1  # ัะดะฐะปะธัั ะปะพะบะฐะปัะฝะพ
git push origin :refs/tags/v1.0.1  # ัะดะฐะปะธัั ะฝะฐ GitHub
git checkout v1.0.0  # ะฒะตัะฝััััั ะบ ะฟัะตะดัะดััะตะน ะฒะตััะธะธ
git tag v1.0.2  # ัะพะทะดะฐัั ะฝะพะฒัะน ัะตะณ
git push origin v1.0.2

# ะะฐัะธะฐะฝั 3: ะััะฝะพะต ะธะทะผะตะฝะตะฝะธะต ะผะฐะฝะธัะตััะฐ (ะฝะต ัะตะบะพะผะตะฝะดัะตััั)
kubectl -n token-price-service set image deployment/token-price-service \
  token-price-service=ghcr.io/uniwertz/token-price-service:v1.0.0
```


#### ะะฒัะพะผะฐัะธัะตัะบะพะต ัะฐะทะฒะตัััะฒะฐะฝะธะต ัะตัะตะท CI/CD

ะัะพะตะบั ะธัะฟะพะปัะทัะตั **GitHub Actions** ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ัะฑะพัะบะธ ะธ ัะฐะทะฒะตัััะฒะฐะฝะธั:

1. **ะัะธ ัะพะทะดะฐะฝะธะธ Pull Request ะฒ main:**
   - ะะฐะฟััะบะฐัััั ัะตััั (unit + e2e)
   - ะัะพะฒะตััะตััั ะปะธะฝัะธะฝะณ

2. **ะัะธ ัะพะทะดะฐะฝะธะธ ัะตะณะฐ `v*.*.*` (ะฝะฐะฟัะธะผะตั, v1.0.0):**
   - ะะฐะฟััะบะฐัััั ัะตััั
   - ะกะพะฑะธัะฐะตััั Docker ะพะฑัะฐะท ะดะปั `linux/amd64`
   - ะะฑัะฐะท ะฟัะฑะปะธะบัะตััั ะฒ GitHub Container Registry (GHCR): `ghcr.io/uniwertz/token-price-service:v1.0.0`
   - ะัะฟะพะปะฝัะตััั security scan ัะตัะตะท Trivy
   - **ะะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐะตััั Pull Request** ั ะพะฑะฝะพะฒะปะตะฝะธะตะผ production ะผะฐะฝะธัะตััะฐ
   - ะะพัะปะต ะผะตัะถะฐ PR, ArgoCD ะฐะฒัะพะผะฐัะธัะตัะบะธ ะดะตะฟะปะพะธั ะฝะพะฒัั ะฒะตััะธั ะฒ ะบะปะฐััะตั

#### ะัะพัะตัั ัะตะปะธะทะฐ

```bash
# 1. ะกะพะทะดะฐะนัะต ะธ ะทะฐะฟััััะต ัะตะณ ะฒะตััะธะธ
git tag v1.0.0
git push origin v1.0.0

# 2. GitHub Actions ะฐะฒัะพะผะฐัะธัะตัะบะธ:
#    - ะกะพะฑะตัะตั ะธ ะพะฟัะฑะปะธะบัะตั Docker ะพะฑัะฐะท
#    - ะกะพะทะดะฐัั PR ั ะพะฑะฝะพะฒะปะตะฝะธะตะผ ะฒะตััะธะธ ะฒ gitops/overlays/production/deployment-patch.yaml

# 3. ะัะพะฒะตัััะต ะธ ัะผะตัะถััะต ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐะฝะฝัะน PR

# 4. ArgoCD ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะดะตะฟะปะพะธั ะฝะพะฒัั ะฒะตััะธั (ะตัะปะธ ะฝะฐัััะพะตะฝ syncPolicy.automated)
```

#### ะััะฝะพะต ัะฐะทะฒะตัััะฒะฐะฝะธะต (ะตัะปะธ ะฝัะถะฝะพ)

```bash
# 1. ะกะพะทะดะฐะฝะธะต ัะตะบัะตัะฐ ะดะปั GHCR (ะพะดะฝะพะบัะฐัะฝะพ)
kubectl -n token-price-service create secret docker-registry ghcr-cred \
  --docker-server=ghcr.io \
  --docker-username=uniwertz \
  --docker-password=$GITHUB_TOKEN \
  --docker-email=your-email@example.com

# 2. ะกะพะทะดะฐะฝะธะต ัะตะบัะตัะฐ ะดะปั Postgres
kubectl -n token-price-service create secret generic postgres-secret \
  --from-literal=password=postgres

# 3. ะัะธะผะตะฝะตะฝะธะต ArgoCD Application
kubectl apply -f gitops/argocd/application.yaml

# 4. ArgoCD ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะฐะทะฒะตัะฝะตั ะฒัะต ัะตััััั ะธะท gitops/overlays/production

# 5. ะัะพะฒะตัะบะฐ ััะฐัััะฐ
kubectl -n token-price-service rollout status deploy/postgres
kubectl -n token-price-service rollout status deploy/kafka
kubectl -n token-price-service rollout status deploy/token-price-service
```


## ะะพะฝัะธะณััะฐัะธั

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

| ะะตัะตะผะตะฝะฝะฐั | ะะฟะธัะฐะฝะธะต | ะะพ ัะผะพะปัะฐะฝะธั |
|------------|----------|--------------|
| NODE_ENV | ะะบััะถะตะฝะธะต | development |
| PORT | ะะพัั ัะตัะฒะธัะฐ | 3000 |
| DATABASE_URL | URL ะฑะฐะทั ะดะฐะฝะฝัั | postgresql://postgres:postgres@postgres:5432/tokens |
| KAFKA_BROKERS | Kafka ะฑัะพะบะตัั | kafka:9092 |
| KAFKA_CLIENT_ID | ID ะบะปะธะตะฝัะฐ Kafka | token-price-service |
| KAFKA_TOPIC | ะขะพะฟะธะบ Kafka | token-price-updates |
| KAFKAJS_NO_PARTITIONER_WARNING | ะัะบะปััะธัั ะฟัะตะดัะฟัะตะถะดะตะฝะธะต KafkaJS | 1 |
| AUTO_SEED_ON_STARTUP | ะะฒัะพะผะฐัะธัะตัะบะพะต ะทะฐะฟะพะปะฝะตะฝะธะต ะดะฐะฝะฝัั | false |
| UPDATE_INTERVAL_SECONDS | ะะฝัะตัะฒะฐะป ะพะฑะฝะพะฒะปะตะฝะธั | 60 |
| MAX_RETRIES | ะะพะปะธัะตััะฒะพ ะฟะพะฟััะพะบ | 5 |
| TIMEOUT_MS | ะขะฐะนะผะฐัั ะทะฐะฟัะพัะพะฒ | 60000 |

### GitOps ะบะพะฝัะธะณััะฐัะธั

ะัะธะปะพะถะตะฝะธะต ะธัะฟะพะปัะทัะตั **GitOps** ะฟะพะดัะพะด ั **ArgoCD** ะธ **Kustomize**:

- `gitops/base/` - ะฑะฐะทะพะฒัะต ะผะฐะฝะธัะตััั (Deployment, Service, ConfigMap, Secret, PVC, Kafka, Zookeeper, Postgres)
- `gitops/overlays/production/` - ะบะพะฝัะธะณััะฐัะธั ะดะปั production (ะพะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะต ัะตััััั, ะพะฑัะฐะทั ะธะท GHCR)
- `gitops/argocd/application.yaml` - ArgoCD Application ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ะดะตะฟะปะพั

**ะัะตะธะผััะตััะฒะฐ GitOps:**
- ะะตะบะปะฐัะฐัะธะฒะฝะฐั ะบะพะฝัะธะณััะฐัะธั ะธะฝััะฐััััะบัััั
- ะะฒัะพะผะฐัะธัะตัะบะฐั ัะธะฝััะพะฝะธะทะฐัะธั ั ะบะปะฐััะตัะพะผ (automated sync + self-heal)
- ะััะพัะธั ะธะทะผะตะฝะตะฝะธะน ัะตัะตะท Git
- ะัะบะฐั ัะตัะตะท revert ะบะพะผะผะธัะฐ
- Review ะฟัะพัะตัั ัะตัะตะท Pull Requests

#### ะกัััะบัััะฐ GitOps
```
gitops/
โโโ argocd/
โ   โโโ application.yaml          # ArgoCD Application manifest
โโโ base/                          # ะะฐะทะพะฒัะต ะผะฐะฝะธัะตััั
โ   โโโ kustomization.yaml        # ะกะฟะธัะพะบ ัะตััััะพะฒ
โ   โโโ deployment.yaml           # ะัะฝะพะฒะฝะพะต ะฟัะธะปะพะถะตะฝะธะต
โ   โโโ service.yaml              # Service ะดะปั ะฟัะธะปะพะถะตะฝะธั
โ   โโโ serviceaccount.yaml       # Service Account ะดะปั CronJob
โ   โโโ configmap.yaml            # ะะพะฝัะธะณััะฐัะธั
โ   โโโ pvc-data.yaml             # PVC ะดะปั ะดะฐะฝะฝัั
โ   โโโ pvc-logs.yaml             # PVC ะดะปั ะปะพะณะพะฒ
โ   โโโ cronjob.yaml              # CronJob ะดะปั ะพะฑะฝะพะฒะปะตะฝะธั ัะตะฝ ะบะฐะถะดัะต 5 ะผะธะฝัั
โ   โโโ kafka-deployment.yaml     # Kafka ะฒ ะบะปะฐััะตัะต
โ   โโโ kafka-service.yaml        # Service ะดะปั Kafka
โ   โโโ zookeeper-deployment.yaml # Zookeeper ะดะปั Kafka
โ   โโโ zookeeper-service.yaml    # Service ะดะปั Zookeeper
โ   โโโ postgres-deployment.yaml  # Postgres ะฒ ะบะปะฐััะตัะต
โ   โโโ postgres-service.yaml     # Service ะดะปั Postgres
โ   โโโ postgres-pvc.yaml         # PVC ะดะปั Postgres
โ   โโโ ingress.yaml              # Ingress (ะฑะฐะทะพะฒัะน)
โโโ overlays/
    โโโ production/               # Production overlay
        โโโ kustomization.yaml    # ะะฐััะธ ะดะปั production
        โโโ deployment-patch.yaml # ะะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะต ัะตััััั, ะพะฑัะฐะท ะธะท GHCR
        โโโ configmap-patch.yaml  # Production ะฟะตัะตะผะตะฝะฝัะต
        โโโ cronjob-patch.yaml    # ะะพะฝััะพะปั suspend ะดะปั CronJob
        โโโ ingress-patch.yaml    # ะะพะผะตะฝั ะธ TLS
        โโโ pvc-patch.yaml        # StorageClass ะดะปั PVC
```

**ะะฐะถะฝะพ:** ะะตััะธั ะพะฑัะฐะทะฐ ะฒ `deployment-patch.yaml` ะพะฑะฝะพะฒะปัะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะตัะตะท CI/CD pipeline ะฟัะธ ัะพะทะดะฐะฝะธะธ ัะตะปะธะทะฐ.


## Workflow ัะฐะทัะฐะฑะพัะบะธ (Developer Guide)

### ะะฑะทะพั ะฟัะพัะตััะฐ

ะัะพะตะบั ะธัะฟะพะปัะทัะตั **GitFlow-ะฟะพะดะพะฑะฝัะน workflow** ั ะฐะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝัะผ CI/CD ัะตัะตะท GitHub Actions ะธ GitOps ัะตัะตะท ArgoCD.

```
feature/* โโPRโโ> dev โโPRโโ> main โโtagโโ> CI/CD โโGitOps PRโโ> ArgoCD โโ> Production
```

### ะะตัะบะธ ะธ ะธั ะฝะฐะทะฝะฐัะตะฝะธะต

| ะะตัะบะฐ | ะะฐะทะฝะฐัะตะฝะธะต | ะะฐัะธัะฐ | ะะตะฟะปะพะน |
|-------|-----------|--------|--------|
| `main` | Production-ready ะบะพะด, ัะพะปัะบะพ ัะตัะตะท PR | ะะฐัะธัะตะฝะฐ | ะะฒัะพะผะฐัะธัะตัะบะธ ัะตัะตะท ArgoCD |
| `dev` | Integration-ะฒะตัะบะฐ ะดะปั ัะฐะทัะฐะฑะพัะบะธ | ะะฐัะธัะตะฝะฐ | ะะตั |
| `feature/*` | Feature-ัะฐะทัะฐะฑะพัะบะฐ | ะะตั | ะะตั |
| `gitops/deploy-*` | ะะฒัะพะผะฐัะธัะตัะบะธะต PR ะดะปั ะดะตะฟะปะพั | ะะฒัะพ-ะผะตัะถ | ะะฐ |

---

### 1. ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ (Feature)

**ะะฐัะฐะปะพ ัะฐะฑะพัั:**
```bash
# ะะฑะฝะพะฒะธัั dev
git checkout dev
git pull origin dev

# ะกะพะทะดะฐัั feature-ะฒะตัะบั
git checkout -b feature/add-new-endpoint

# ะฃััะฐะฝะพะฒะธัั ะทะฐะฒะธัะธะผะพััะธ (ะตัะปะธ ะฝัะถะฝะพ)
npm install
```

**ะะฐะทัะฐะฑะพัะบะฐ:**
```bash
# ะะฐะฟัััะธัั ะปะพะบะฐะปัะฝัั ะธะฝััะฐััััะบัััั (PostgreSQL, Kafka)
docker-compose up -d

# ะะฐะฟัััะธัั ะฟัะธะปะพะถะตะฝะธะต ะฒ dev-ัะตะถะธะผะต
npm run start:dev

# ะะธัะฐัั ะบะพะด, ัะตััั
# ...

# ะัะพะณะฝะฐัั ัะตััั ะปะพะบะฐะปัะฝะพ
npm test                # Unit ัะตััั
npm run test:e2e        # E2E ัะตััั
npm run lint            # ะะธะฝัะตั

# ะะพะผะผะธัั (Conventional Commits)
git add .
git commit -m "feat(pricing): add endpoint for token metadata"
git commit -m "test(pricing): add e2e tests for metadata endpoint"
```

**Conventional Commits ัะพัะผะฐั:**
- `feat:` โ ะฝะพะฒะฐั ััะฝะบัะธะพะฝะฐะปัะฝะพััั
- `fix:` โ ะธัะฟัะฐะฒะปะตะฝะธะต ะฑะฐะณะฐ
- `test:` โ ะดะพะฑะฐะฒะปะตะฝะธะต/ะธะทะผะตะฝะตะฝะธะต ัะตััะพะฒ
- `refactor:` โ ัะตัะฐะบัะพัะธะฝะณ ะฑะตะท ะธะทะผะตะฝะตะฝะธั ััะฝะบัะธะพะฝะฐะปัะฝะพััะธ
- `docs:` โ ะธะทะผะตะฝะตะฝะธั ะฒ ะดะพะบัะผะตะฝัะฐัะธะธ
- `chore:` โ ะธะฝััะฐััััะบัััะฝัะต ะธะทะผะตะฝะตะฝะธั (deps, config)

---

### 2. Pull Request ะฒ `dev`

**ะกะพะทะดะฐะฝะธะต PR:**
```bash
# Push feature-ะฒะตัะบะธ
git push origin feature/add-new-endpoint

# ะกะพะทะดะฐัั PR ัะตัะตะท GitHub UI ะธะปะธ CLI
gh pr create --base dev --head feature/add-new-endpoint \
  --title "feat(pricing): add endpoint for token metadata" \
  --body "### Changes:
- Added GET /pricing/tokens/:id/metadata endpoint
- Added unit and e2e tests
- Updated OpenAPI spec

### Testing:
- Unit tests pass
- E2E tests pass
- Lint pass"
```

**CI ะฟัะพะฒะตัะบะธ ะฝะฐ PR โ dev:**
- Lint (TypeScript, ESLint, Prettier)
- Unit ัะตััั
- E2E ัะตััั
- **ะะฑัะฐะท ะะ ะฟัะฑะปะธะบัะตััั** (ัะพะปัะบะพ ะฟัะพะฒะตัะบะธ)

**ะะพัะปะต ะฐะฟััะฒะฐ:**
```bash
# Merge ัะตัะตะท GitHub UI (Squash and Merge ัะตะบะพะผะตะฝะดัะตััั)
# ะะปะธ ัะตัะตะท CLI:
gh pr merge <PR_NUMBER> --squash --delete-branch
```

---

### 3. Pull Request ะธะท `dev` ะฒ `main`

**ะะพะณะดะฐ:** ะะพัะปะต ะฝะฐะบะพะฟะปะตะฝะธั ัะธั ะฒ `dev`, ะณะพัะพะฒะฝะพััั ะบ ัะตะปะธะทั.

**ะกะพะทะดะฐะฝะธะต PR:**
```bash
# ะฃะฑะตะดะธัััั ััะพ dev ะฐะบััะฐะปะตะฝ
git checkout dev
git pull origin dev

# ะกะพะทะดะฐัั PR dev โ main
gh pr create --base main --head dev \
  --title "chore(release): prepare v1.0.8" \
  --body "### Release v1.0.8

**Features:**
- feat(pricing): add endpoint for token metadata
- feat(cronjob): optimize schedule to 5 minutes

**Fixes:**
- fix(kafka): update broker hostname

**Changes:**
- refactor(domain): improve TokenPrice value object

**Tests:**
- All unit and e2e tests passing"
```

**CI ะฟัะพะฒะตัะบะธ ะฝะฐ PR โ main:**
- Lint
- Unit ัะตััั
- E2E ัะตััั
- **ะะฑัะฐะท ะะ ะฟัะฑะปะธะบัะตััั** (ะฟัะฑะปะธะบะฐัะธั ัะพะปัะบะพ ะฟะพ ัะตะณั)

**ะะพัะปะต ะฐะฟััะฒะฐ:**
```bash
# Merge ัะตัะตะท GitHub UI (Create a merge commit)
gh pr merge <PR_NUMBER> --merge
```

---

### 4. ะะตะปะธะท (ะกะพะทะดะฐะฝะธะต ัะตะณะฐ)

**ะะพัะปะต ะผะตัะถะฐ PR ะฒ main:**
```bash
# ะะตัะตะบะปััะธัััั ะฝะฐ main
git checkout main
git pull origin main

# ะกะพะทะดะฐัั ัะตะณ (Semantic Versioning)
git tag v1.0.8 -m "Release v1.0.8: metadata endpoint and cronjob optimization"

# Push ัะตะณะฐ (ะทะฐะฟััะบะฐะตั CI/CD)
git push origin v1.0.8
```

**Versioning:**
- `v1.0.0` โ `v1.0.1` โ patch (bug fixes)
- `v1.0.0` โ `v1.1.0` โ minor (new features, backward compatible)
- `v1.0.0` โ `v2.0.0` โ major (breaking changes)

---

### 5. CI/CD Pipeline (ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะพ ัะตะณั)

**GitHub Actions ะฒัะฟะพะปะฝัะตั:**

1. **Test** (ะฟะฐัะฐะปะปะตะปัะฝะพ):
   - Lint
   - Unit tests
   - E2E tests
   - Security scan (Trivy)

2. **Build & Push**:
   - ะกะฑะพัะบะฐ Docker ะพะฑัะฐะทะฐ
   - ะขะตะณะธัะพะฒะฐะฝะธะต: `ghcr.io/uniwertz/token-price-service:v1.0.8` + `latest`
   - ะัะฑะปะธะบะฐัะธั ะฒ GitHub Container Registry

3. **GitOps Update**:
   - ะกะพะทะดะฐะฝะธะต ะฒะตัะบะธ `gitops/deploy-v1.0.8`
   - ะะฑะฝะพะฒะปะตะฝะธะต `gitops/overlays/production/deployment-patch.yaml`:
     ```yaml
     image: ghcr.io/uniwertz/token-price-service:v1.0.8
     ```
   - ะกะพะทะดะฐะฝะธะต Pull Request `gitops/deploy-v1.0.8` โ `main`
   - **ะะฒัะพะผะฐัะธัะตัะบะธะน ะผะตัะถ PR** (ะตัะปะธ ะฒัะต ะฟัะพะฒะตัะบะธ ะฟัะพัะปะธ)

**ะะพะฝะธัะพัะธะฝะณ CI/CD:**
- GitHub Actions: https://github.com/uniwertz/token-price-service/actions
- Container Registry: https://github.com/uniwertz/token-price-service/pkgs/container/token-price-service

---

### 6. ะะตะฟะปะพะน ะฒ Production (GitOps)

**ะะพัะปะต ะผะตัะถะฐ GitOps PR:**
1. **ArgoCD** ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะฐััะถะธะฒะฐะตั ะธะทะผะตะฝะตะฝะธั ะฒ `main`
2. ะกะธะฝััะพะฝะธะทะธััะตั ะธะทะผะตะฝะตะฝะธั ั ะบะปะฐััะตัะพะผ Kubernetes
3. ะะฐะฟััะบะฐะตั rolling update ะดะตะฟะปะพั
4. ะัะพะฒะตััะตั readiness/liveness probes

**ะัะพะฒะตัะบะฐ ะดะตะฟะปะพั:**
```bash
# ะกัะฐััั ะฟะพะดะฐ
kubectl -n token-price-service get pods

# ะกัะฐััั rolling update
kubectl -n token-price-service rollout status deploy/token-price-service

# ะะพะณะธ ะฟัะธะปะพะถะตะฝะธั
kubectl -n token-price-service logs deploy/token-price-service --tail=100 -f

# ะัะพะฒะตัะบะฐ ัะตัะตะท API
curl https://dsavin.tech/pricing/status
```

**ArgoCD UI (ะตัะปะธ ะดะพัััะฟะตะฝ):**
```bash
# Port-forward ะดะปั ะดะพัััะฟะฐ ะบ ArgoCD
kubectl port-forward -n argocd svc/argocd-server 8080:443

# ะัะบัััั ะฒ ะฑัะฐัะทะตัะต: https://localhost:8080
```

---

### 7. ะัะบะฐั ะฒะตััะธะธ

**ะกะฟะพัะพะฑ 1: Revert GitOps PR**
```bash
# ะะฐะนัะธ GitOps PR ะดะปั ะพัะบะฐััะฒะฐะตะผะพะน ะฒะตััะธะธ
gh pr list --state merged --search "gitops/deploy"

# Revert ะผะตัะถะฐ
git revert <merge_commit_sha> -m 1
git push origin main

# ArgoCD ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพัะบะฐัะธั ะบ ะฟัะตะดัะดััะตะน ะฒะตััะธะธ
```

**ะกะฟะพัะพะฑ 2: ะััะฝะพะน ะพัะบะฐั ัะตัะตะท kubectl**
```bash
# ะัะบะฐัะธัั ะฝะฐ ะฟัะตะดัะดัััั ะฒะตััะธั
kubectl -n token-price-service rollout undo deploy/token-price-service

# ะัะบะฐัะธัั ะฝะฐ ะบะพะฝะบัะตัะฝัั ัะตะฒะธะทะธั
kubectl -n token-price-service rollout history deploy/token-price-service
kubectl -n token-price-service rollout undo deploy/token-price-service --to-revision=3
```

**ะกะฟะพัะพะฑ 3: ะะพะฒัะน ัะตะณ ั ัะธะบัะพะผ**
```bash
# ะัะฟัะฐะฒะธัั ะฟัะพะฑะปะตะผั ะฒ dev
git checkout dev
# ... fix ...
git commit -m "fix: critical bug in v1.0.8"

# ะกะพะทะดะฐัั PR dev โ main
# ะกะพะทะดะฐัั ะฝะพะฒัะน ัะตะณ v1.0.9
git tag v1.0.9
git push origin v1.0.9
```

---

### 8. Hotfix (ััะพัะฝะพะต ะธัะฟัะฐะฒะปะตะฝะธะต ะฒ production)

**ะะปั ะบัะธัะธัะตัะบะธั ะฑะฐะณะพะฒ:**
```bash
# ะกะพะทะดะฐัั hotfix-ะฒะตัะบั ะพั main
git checkout main
git pull origin main
git checkout -b hotfix/critical-security-fix

# ะัะฟัะฐะฒะธัั ะฟัะพะฑะปะตะผั
# ... code ...
git commit -m "fix(security): patch CVE-2024-XXXXX"

# ะกะพะทะดะฐัั PR hotfix โ main (ะผะธะฝัั dev)
gh pr create --base main --head hotfix/critical-security-fix \
  --title "fix(security): patch CVE-2024-XXXXX" \
  --label "hotfix" --label "security"

# ะะพัะปะต ะผะตัะถะฐ:
git tag v1.0.9
git push origin v1.0.9

# ะกะธะฝััะพะฝะธะทะธัะพะฒะฐัั dev ั main
git checkout dev
git merge main
git push origin dev
```

---

### ะะพะปะฝะฐั ะดะธะฐะณัะฐะผะผะฐ ะฟัะพัะตััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะะะะะะะะขะงะะ                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ 1. ะกะพะทะดะฐัั feature-ะฒะตัะบั ะพั dev                                โ
โ    git checkout -b feature/my-feature                           โ
โ                                                                 โ
โ 2. ะะฐะทัะฐะฑะพัะบะฐ + ัะตััั ะปะพะบะฐะปัะฝะพ                                 โ
โ    npm test && npm run test:e2e                                 โ
โ                                                                 โ
โ 3. Push ะธ ัะพะทะดะฐะฝะธะต PR โ dev                                    โ
โ    gh pr create --base dev                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ CI: Pull Request Checks (ะฝะฐ feature โ dev)                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โ Lint                                                          โ
โ โ Unit Tests                                                    โ
โ โ E2E Tests                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ (ะฟะพัะปะต ะฐะฟััะฒะฐ)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Merge feature โ dev                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โ (ะบะพะณะดะฐ ะณะพัะพะฒ ัะตะปะธะท)
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ PR: dev โ main                                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ CI: Lint + Tests (ะฑะตะท ะฟัะฑะปะธะบะฐัะธะธ ะพะฑัะฐะทะฐ)                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ (ะฟะพัะปะต ะฐะฟััะฒะฐ)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Merge dev โ main                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะะะะะ                                                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ git tag v1.0.X                                                  โ
โ git push origin v1.0.X  โโโ ะะะะฃะกะ CI/CD                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ CI/CD: GitHub Actions (ะฝะฐ ัะตะณ)                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ 1. Test: Lint + Unit + E2E + Security Scan                     โ
โ 2. Build: Docker ะพะฑัะฐะท โ GHCR                                   โ
โ 3. GitOps PR: ะพะฑะฝะพะฒะธัั deployment-patch.yaml                    โ
โ 4. Auto-merge GitOps PR โ main                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ PRODUCTION: ArgoCD (GitOps)                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ 1. ะะฑะฝะฐััะถะธะฒะฐะตั ะธะทะผะตะฝะตะฝะธั ะฒ main                                โ
โ 2. ะัะธะผะตะฝัะตั ะฝะพะฒัะน ะพะฑัะฐะท ะฒ ะบะปะฐััะตั                              โ
โ 3. Rolling update ะดะตะฟะปะพั                                        โ
โ 4. Health checks (readiness/liveness)                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
                  PRODUCTION READY
```

---

### ะงะตะบ-ะปะธัั ะดะปั ัะฐะทัะฐะฑะพััะธะบะฐ

**ะะตัะตะด ัะพะทะดะฐะฝะธะตะผ PR:**
- [ ] ะะพะด ัะพะพัะฒะตัััะฒัะตั ััะธะปั ะฟัะพะตะบัะฐ (lint pass)
- [ ] ะะพะฑะฐะฒะปะตะฝั unit-ัะตััั ะดะปั ะฝะพะฒะพะน ััะฝะบัะธะพะฝะฐะปัะฝะพััะธ
- [ ] ะะพะฑะฐะฒะปะตะฝั e2e-ัะตััั (ะตัะปะธ ะฝัะถะฝะพ)
- [ ] ะัะต ัะตััั ะฟัะพัะพะดัั ะปะพะบะฐะปัะฝะพ
- [ ] Conventional Commits ัะพะฑะปัะดะตะฝั
- [ ] README/ะดะพะบัะผะตะฝัะฐัะธั ะพะฑะฝะพะฒะปะตะฝะฐ (ะตัะปะธ ะฝัะถะฝะพ)

**ะะตัะตะด ัะตะปะธะทะพะผ:**
- [ ] ะัะต PR ะฒ `dev` ัะผะตัะถะตะฝั
- [ ] PR `dev โ main` ัะพะทะดะฐะฝ ะธ ะฐะฟััะฒะปะตะฝ
- [ ] ะะตััะธั ัะตะณะฐ ัะพะพัะฒะตัััะฒัะตั Semantic Versioning
- [ ] Release notes ะฟะพะดะณะพัะพะฒะปะตะฝั (ะพะฟะธัะฐะฝะธะต ะธะทะผะตะฝะตะฝะธะน)

**ะะพัะปะต ัะตะปะธะทะฐ:**
- [ ] CI/CD pipeline ะทะฐะฒะตััะธะปัั ััะฟะตัะฝะพ (ะทะตะปัะฝัะน)
- [ ] GitOps PR ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะผะตัะถะตะฝ
- [ ] ArgoCD ัะธะฝััะพะฝะธะทะธัะพะฒะฐะป ะธะทะผะตะฝะตะฝะธั
- [ ] ะัะธะปะพะถะตะฝะธะต ะฒ production ัะฐะฑะพัะฐะตั (ะฟัะพะฒะตัะธัั `/pricing/status`)
- [ ] CronJob ะพะฑะฝะพะฒะปะตะฝะธั ัะตะฝ ัะฐะฑะพัะฐะตั (ะฟัะพะฒะตัะธัั jobs)

---

### ะะพะปะตะทะฝัะต ะบะพะผะฐะฝะดั

**Git:**
```bash
# ะกะธะฝััะพะฝะธะทะฐัะธั ั upstream
git fetch origin
git checkout dev
git pull origin dev

# ะัะพัะผะพัั ะธััะพัะธะธ
git log --oneline --graph --all -20

# ะัะพัะผะพัั ะธะทะผะตะฝะตะฝะธะน ะฒ ัะฐะนะปะต
git log -p -- path/to/file.ts
```

**Docker:**
```bash
# ะะพะบะฐะปัะฝะฐั ัะฑะพัะบะฐ ะพะฑัะฐะทะฐ
docker build -t token-price-service:local .

# ะะฐะฟััะบ ะบะพะฝัะตะนะฝะตัะฐ ะปะพะบะฐะปัะฝะพ
docker run -p 3000:3000 --env-file .env token-price-service:local
```

**Kubernetes:**
```bash
# ะัะพัะผะพัั ะฒัะตั ัะตััััะพะฒ
kubectl -n token-price-service get all

# Exec ะฒ ะฟะพะด ะดะปั ะดะตะฑะฐะณะฐ
kubectl -n token-price-service exec -it deploy/token-price-service -- sh

# ะัะพัะผะพัั ะปะพะณะพะฒ ั ัะธะปัััะฐัะธะตะน
kubectl -n token-price-service logs deploy/token-price-service | grep ERROR

# ะคะพัะฒะฐัะด ะฟะพััะฐ ะดะปั ะปะพะบะฐะปัะฝะพะณะพ ะดะพัััะฟะฐ
kubectl -n token-price-service port-forward deploy/token-price-service 3000:3000
```

**GitHub CLI:**
```bash
# ะัะพัะผะพัั PR
gh pr list
gh pr view <PR_NUMBER>

# ะัะพัะผะพัั Actions
gh run list
gh run view <RUN_ID>

# ะัะพัะผะพัั ัะตะปะธะทะพะฒ
gh release list
gh release view v1.0.7
```


## ะะปะฐะฝะธัะพะฒะฐะฝะธะต ะพะฑะฝะพะฒะปะตะฝะธั ัะตะฝ

### Kubernetes CronJob (ะฝะฐัััะพะตะฝ ะธ ะฒะบะปััะตะฝ)

ะกะตัะฒะธั ะธัะฟะพะปัะทัะตั **Kubernetes CronJob** ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ะพะฑะฝะพะฒะปะตะฝะธั ัะตะฝ **ะบะฐะถะดัะต 5 ะผะธะฝัั**. ะัััะพะตะฝะฝะพะณะพ ะฟะปะฐะฝะธัะพะฒัะธะบะฐ ะฒ ะฟัะธะปะพะถะตะฝะธะธ ะฝะตั โ ะทะฐะฟััะบ ัะพะปัะบะพ ะธะทะฒะฝะต.

**ะะพะฝัะธะณััะฐัะธั:**
- ะคะฐะนะป: `gitops/base/cronjob.yaml`
- ะะฐัะฟะธัะฐะฝะธะต: `*/5 * * * *` (ะบะฐะถะดัะต 5 ะผะธะฝัั)
- Concurrency: `Forbid` (ะฝะต ะทะฐะฟััะบะฐัั ะฝะพะฒัะน job ะตัะปะธ ะฟัะตะดัะดััะธะน ะฒัะฟะพะปะฝัะตััั)
- ะััะพัะธั: 3 ััะฟะตัะฝัั + 3 ะฝะตัะดะฐัะฝัั jobs
- Retry: 2 ะฟะพะฟััะบะธ ะฟัะธ ะฝะตัะดะฐัะต
- ะะตััััั: 10m CPU / 16Mi RAM (requests), 50m CPU / 64Mi RAM (limits)

**ะฃะฟัะฐะฒะปะตะฝะธะต CronJob:**
```bash
# ะัะพะฒะตัะธัั ััะฐััั
kubectl -n token-price-service get cronjob price-updater

# ะะพัะผะพััะตัั ะฟะพัะปะตะดะฝะธะต jobs
kubectl -n token-price-service get jobs --sort-by=.metadata.creationTimestamp

# ะะพัะผะพััะตัั ะปะพะณะธ ะฟะพัะปะตะดะฝะตะณะพ job
kubectl -n token-price-service logs -l app=price-updater --tail=50

# ะัะธะพััะฐะฝะพะฒะธัั CronJob (ะตัะปะธ ะฝัะถะฝะพ)
kubectl -n token-price-service patch cronjob price-updater -p '{"spec":{"suspend":true}}'

# ะะพะทะพะฑะฝะพะฒะธัั CronJob
kubectl -n token-price-service patch cronjob price-updater -p '{"spec":{"suspend":false}}'

# ะััะฝะพะน ะทะฐะฟััะบ (ัะพะทะดะฐัั job ะฒะฝะต ัะฐัะฟะธัะฐะฝะธั)
kubectl -n token-price-service create job --from=cronjob/price-updater manual-update-$(date +%s)
```

### ะััะฝะพะน ะทะฐะฟััะบ ัะตัะตะท API

ะัะปะธ ะฝัะถะฝะพ ะทะฐะฟัััะธัั ะพะฑะฝะพะฒะปะตะฝะธะต ะฒัััะฝัั:
```bash
# ะะพะบะฐะปัะฝะพ
curl -X POST http://localhost:3000/pricing/trigger-update

# ะ ะบะปะฐััะตัะต (ะธะท ะดััะณะพะณะพ ะฟะพะดะฐ; ะฒ ะฟัะพะดะต ััะตะฑัะตััั ะฒะฝัััะตะฝะฝะธะน ัะพะบะตะฝ)
kubectl -n token-price-service exec -it deploy/token-price-service -- \
  curl -X POST -H "x-internal-job-token: $INTERNAL_JOB_TOKEN" http://localhost:3000/pricing/trigger-update
```

## API Endpoints

### Health Check
```
GET /pricing/health
```
ะะพะทะฒัะฐัะฐะตั ััะฐััั ัะตัะฒะธัะฐ ะธ ัะตะบััะธะน timestamp.

### Status
```
GET /pricing/status
```
ะะพะทะฒัะฐัะฐะตั ะดะตัะฐะปัะฝัั ะธะฝัะพัะผะฐัะธั ะพ ัะพััะพัะฝะธะธ ัะตัะฒะธัะฐ: ะพะฑัะตะต ัะธัะปะพ ัะพะบะตะฝะพะฒ ะธ `lastUpdate` (ะฒัะตะผั ะฟะพัะปะตะดะฝะตะณะพ ะพะฑะฝะพะฒะปะตะฝะธั ัะตะฝ).

### Trigger Update
```
POST /pricing/trigger-update
```
ะะฐะฟััะบะฐะตั ะพะฑะฝะพะฒะปะตะฝะธะต ัะตะฝ ะดะปั ะฒัะตั ัะพะบะตะฝะพะฒ. ะัะฟะพะปัะทัะตััั ะฒะฝะตัะฝะธะผะธ ะฟะปะฐะฝะธัะพะฒัะธะบะฐะผะธ.

## ะขะตััะธัะพะฒะฐะฝะธะต

### Unit ัะตััั
```bash
npm test
```

### E2E ัะตััั
```bash
npm run test:e2e
```

### ะะพะบัััะธะต ะบะพะดะฐ
```bash
npm run test:cov
```

## ะะพะฝะธัะพัะธะฝะณ

### ะะพะณะธ
ะกะตัะฒะธั ะธัะฟะพะปัะทัะตั ััััะบัััะธัะพะฒะฐะฝะฝะพะต JSON ะปะพะณะธัะพะฒะฐะฝะธะต ั ะฒัะตะผะตะฝะฝัะผะธ ะผะตัะบะฐะผะธ ะธ ะบะพะฝัะตะบััะพะผ.

### ะะตััะธะบะธ
ะะฝัะตะณัะฐัะธั ั OpenTelemetry ะดะปั ัะฑะพัะฐ ะผะตััะธะบ ะธ ััะฐััะธัะพะฒะบะธ.

### Health Checks
ะัััะพะตะฝะฝัะต health checks ะดะปั Kubernetes liveness ะธ readiness probes.


## ะะตะทะพะฟะฐัะฝะพััั

- ะัะต ัะตะบัะตัั ััะฐะฝัััั ะฒ Kubernetes Secrets
- ะะพะฝัะธะณััะฐัะธั ัะตัะตะท ConfigMaps
- Health checks ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ
- Graceful shutdown ะดะปั ะบะพััะตะบัะฝะพะณะพ ะทะฐะฒะตััะตะฝะธั

## ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะตััััั

### ะะพะปะตะทะฝัะต ะบะพะผะฐะฝะดั

```bash
# ะัะพะฒะตัะบะฐ ััะฐัััะฐ ะฒัะตั ัะตััััะพะฒ
kubectl get all -n token-price-service

# ะัะพะฒะตัะบะฐ ััะฐัััะฐ ะบะพะฝะบัะตัะฝัั ะบะพะผะฟะพะฝะตะฝัะพะฒ
kubectl -n token-price-service get pods,svc,pvc,deploy

# ะัะพัะผะพัั ะปะพะณะพะฒ ะพัะฝะพะฒะฝะพะณะพ ะฟัะธะปะพะถะตะฝะธั
kubectl -n token-price-service logs -l app=token-price-service -f

# ะัะพัะผะพัั ะปะพะณะพะฒ Kafka
kubectl -n token-price-service logs -l app=kafka -f

# ะัะพัะผะพัั ะปะพะณะพะฒ Postgres
kubectl -n token-price-service logs -l app=postgres -f

# Port-forward ะดะปั ะปะพะบะฐะปัะฝะพะณะพ ะดะพัััะฟะฐ
kubectl -n token-price-service port-forward svc/token-price-service 3000:3000

# ะะพัััะฟ ะบ ArgoCD (ะตัะปะธ ัััะฐะฝะพะฒะปะตะฝ)
kubectl -n argocd port-forward svc/argocd-server 8080:443
```